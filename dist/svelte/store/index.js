import{noop as t,run_all as e,is_function as n}from"@typhonjs-fvtt/runtime/svelte/internal";function r(){}function o(t){return t()}function s(t,...e){if(null==t)return r;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function i(t){let e;return s(t,(t=>e=t))(),e}Promise.resolve();const u=[];function c(t,e){return{subscribe:a(t,e).subscribe}}function a(t,e=r){let n;const o=new Set;function s(e){if(s=e,((r=t)!=r?s==s:r!==s||r&&"object"==typeof r||"function"==typeof r)&&(t=e,n)){const e=!u.length;for(const e of o)e[1](),u.push(e,t);if(e){for(let t=0;t<u.length;t+=2)u[t][0](u[t+1]);u.length=0}}var r,s}return{set:s,update:function(e){s(e(t))},subscribe:function(i,u=r){const c=[i,u];return o.add(c),1===o.size&&(n=e(s)||r),i(t),()=>{o.delete(c),0===o.size&&(n(),n=null)}}}}function f(t,e,n){const i=!Array.isArray(t),u=i?[t]:t,a=e.length<2;return c(n,(t=>{let n=!1;const c=[];let f=0,l=r;const g=()=>{if(f)return;l();const n=e(i?c[0]:c,t);a?t(n):l="function"==typeof n?n:r},b=u.map(((t,e)=>s(t,(t=>{c[e]=t,f&=~(1<<e),n&&g()}),(()=>{f|=1<<e}))));return n=!0,g(),function(){b.forEach(o),l()}}))}function l(t,e){var n=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}(t,e);return function(t,e){return e.get?e.get.call(t):e.value}(t,n)}function g(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function b(r){function o(t,e,n){return{subscribe:s(t,e,n).subscribe}}function s(e,n,o=t){r&&(r.getItem(e)&&(n=JSON.parse(r.getItem(e))),r.setItem(e,JSON.stringify(n)));const s=a(n,o?function(t){return o((function(n){return r&&r.setItem(e,JSON.stringify(n)),t(n)}))}:void 0);function u(t){r&&r.setItem(e,JSON.stringify(t)),s.set(t)}return{set:u,update:function(t){u(t(i(s)))},subscribe:function(e,n=t){return s.subscribe(e,n)}}}return{readable:o,writable:s,derived:function(s,i,u,c){const a=!Array.isArray(i),f=a?[i]:i;return r&&r.getItem(s)&&(c=JSON.parse(r.getItem(s))),o(s,c,(r=>{let o=!1;const s=[];let i=0,c=t;const l=()=>{if(i)return;c();const e=a?s[0]:s;if(u.length<2)r(u(e));else{const o=u(e,r);c=n(o)?o:t}},g=f.map(((t,e)=>t.subscribe((t=>{s[e]=t,i&=~(1<<e),o&&l()}),(()=>{i|=1<<e}))));return o=!0,l(),function(){e(g),c()}}))},get:i}}var p=b("undefined"!=typeof window?window.localStorage:void 0).writable,m=new WeakMap;class w{constructor(){g(this,m,{writable:!0,value:new Map})}getItem(t,e){let n;const r=localStorage.getItem(t);return void 0!==r&&(n=JSON.parse(r)),n}getStore(t,e){return d(l(this,m),t,e)}setItem(t,e){d(l(this,m),t).set(e)}swapItemBoolean(t,e){const n=d(l(this,m),t,e),r=n.get(),o="boolean"==typeof r&&!r;return n.set(o),o}}function d(t,e,n){let r=t.get(e);return void 0===r&&(r=function(t,e){try{localStorage.getItem(t)&&(e=JSON.parse(localStorage.getItem(t)))}catch(t){}const n=p(t,e);return n.get=()=>i(n),n}(e,n),t.set(e,r)),r}var h=b("undefined"!=typeof window?window.sessionStorage:void 0).writable,v=new WeakMap;class S{constructor(){g(this,v,{writable:!0,value:new Map})}getItem(t){let e;const n=sessionStorage.getItem(t);return void 0!==n&&(e=JSON.parse(n)),e}getStore(t,e){return y(l(this,v),t,e)}setItem(t,e){y(l(this,v),t).set(e)}swapItemBoolean(t,e){const n=y(l(this,v),t,e),r=n.get(),o="boolean"==typeof r&&!r;return n.set(o),o}}function y(t,e,n){let r=t.get(e);return void 0===r&&(r=function(t,e){try{sessionStorage.getItem(t)&&(e=JSON.parse(sessionStorage.getItem(t)))}catch(t){}const n=h(t,e);return n.get=()=>i(n),n}(e,n),t.set(e,r)),r}export{w as LocalStorage,S as SessionStorage,f as derived,i as get,c as readable,a as writable};
