{"version":3,"file":"index.js","sources":["../../src/action/draggable.js"],"sourcesContent":["/**\r\n * Provides an action to enable pointer dragging of an HTMLElement and invoke `setPosition` on given Positionable\r\n * object provided. When the attached boolean store state changes the draggable action is enabled or disabled.\r\n *\r\n * @param {HTMLElement}       node - The node associated with the action.\r\n *\r\n * @param {object}            params - Required parameters.\r\n *\r\n * @param {Positionable}      params.positionable - A positionable object.\r\n *\r\n * @param {Readable<boolean>} params.booleanStore - A Svelte store that contains a boolean.\r\n *\r\n * @returns {{update: Function, destroy: Function}} The action lifecycle methods.\r\n */\r\nexport function draggable(node, { positionable, booleanStore })\r\n{\r\n   /**\r\n    * Duplicate the app / Positionable starting position to track differences.\r\n    *\r\n    * @type {object}\r\n    */\r\n   let position = null;\r\n\r\n   /**\r\n    * Stores the initial X / Y on drag down.\r\n    *\r\n    * @type {object}\r\n    */\r\n   let initialPosition = {};\r\n\r\n   /**\r\n    * Throttle mousemove event handling to 60fps\r\n    *\r\n    * @type {number}\r\n    */\r\n   let moveTime = 0;\r\n\r\n   /**\r\n    * Stores the active state and is used to cut off any active dragging when the store value changes.\r\n    *\r\n    * @type {Readable<boolean>}\r\n    */\r\n   let active = booleanStore;\r\n\r\n   /**\r\n    * Remember event handlers associated with this action so they may be later unregistered.\r\n    *\r\n    * @type {object}\r\n    */\r\n   const handlers = {\r\n      dragDown: ['pointerdown', (e) => onDragPointerDown(e), false],\r\n      dragMove: ['pointermove', (e) => onDragPointerMove(e), false],\r\n      dragUp: ['pointerup', (e) => onDragPointerUp(e), false]\r\n   };\r\n\r\n   /**\r\n    * Activates listeners.\r\n    */\r\n   function activateListeners()\r\n   {\r\n      active = true;\r\n\r\n      // Drag handlers\r\n      node.addEventListener(...handlers.dragDown);\r\n      node.classList.add('draggable');\r\n   }\r\n\r\n   /**\r\n    * Removes listeners.\r\n    */\r\n   function removeListeners()\r\n   {\r\n      active = false;\r\n\r\n      // Drag handlers\r\n      node.removeEventListener(...handlers.dragDown);\r\n      node.removeEventListener(...handlers.dragMove);\r\n      node.removeEventListener(...handlers.dragUp);\r\n      node.classList.remove('draggable');\r\n   }\r\n\r\n   if (active)\r\n   {\r\n      activateListeners();\r\n   }\r\n\r\n   /**\r\n    * Handle the initial pointer down which activates dragging behavior for the positionable.\r\n    *\r\n    * @param {PointerEvent} event - The pointer down event.\r\n    */\r\n   function onDragPointerDown(event)\r\n   {\r\n      event.preventDefault();\r\n\r\n      // Record initial position\r\n      position = foundry.utils.duplicate(positionable.position);\r\n      initialPosition = { x: event.clientX, y: event.clientY };\r\n\r\n      // Add temporary handlers\r\n      globalThis.addEventListener(...handlers.dragMove);\r\n      globalThis.addEventListener(...handlers.dragUp);\r\n   }\r\n\r\n   /**\r\n    * Move the positionable.\r\n    *\r\n    * @param {PointerEvent} event - The pointer move event.\r\n    */\r\n   function onDragPointerMove(event)\r\n   {\r\n      event.preventDefault();\r\n\r\n      if (!active) { return; }\r\n\r\n      // Limit dragging to 60 updates per second\r\n      const now = Date.now();\r\n\r\n      if ((now - moveTime) < (1000 / 60)) { return; }\r\n\r\n      moveTime = now;\r\n\r\n      // Update application position\r\n      positionable.setPosition({\r\n         left: position.left + (event.clientX - initialPosition.x),\r\n         top: position.top + (event.clientY - initialPosition.y)\r\n      });\r\n   }\r\n\r\n   /**\r\n    * Conclude the dragging behavior when the mouse is release, setting the final position and removing listeners\r\n    *\r\n    * @param {PointerEvent} event - The pointer up event.\r\n    */\r\n   function onDragPointerUp(event)\r\n   {\r\n      event.preventDefault();\r\n      globalThis.removeEventListener(...handlers.dragMove);\r\n      globalThis.removeEventListener(...handlers.dragUp);\r\n   }\r\n\r\n   return {\r\n      update: ({ booleanStore }) =>  // eslint-disable-line no-shadow\r\n      {\r\n         if (booleanStore) { activateListeners(); }\r\n         else { removeListeners(); }\r\n      },\r\n\r\n      destroy: () => removeListeners()\r\n   };\r\n}"],"names":[],"mappings":"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"}