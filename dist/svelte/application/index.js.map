{"version":3,"file":"index.js","sources":["../../node_modules/@typhonjs-utils/object/src/functions.js","../../src/application/GetSvelteData.js","../../src/application/SvelteApplication.js","../../src/application/TJSDialog.js","../../src/application/TJSMenu.js"],"sourcesContent":["/**\r\n * Provides common object manipulation utilities including depth traversal, obtaining accessors, safely setting values /\r\n * equality tests, and validation.\r\n */\r\n\r\nconst s_TAG_MAP = '[object Map]';\r\nconst s_TAG_SET = '[object Set]';\r\nconst s_TAG_STRING = '[object String]';\r\n\r\n/**\r\n * @typedef {object} ValidationEntry - Provides data for a validation check.\r\n *\r\n * @property {string}               [type] - Optionally tests with a typeof check.\r\n *\r\n * @property {Array<*>|Function|Set<*>}  [expected] - Optional array, function, or set of expected values to test\r\n * against.\r\n *\r\n * @property {string}               [message] - Optional message to include.\r\n *\r\n * @property {boolean}              [required=true] - When false if the accessor is missing validation is skipped.\r\n *\r\n * @property {boolean}              [error=true] - When true and error is thrown otherwise a boolean is returned.\r\n */\r\n\r\n/**\r\n * Freezes all entries traversed that are objects including entries in arrays.\r\n *\r\n * @param {object|Array}   data - An object or array.\r\n *\r\n * @param {string[]}       skipFreezeKeys - An array of strings indicating keys of objects to not freeze.\r\n *\r\n * @returns {object|Array} The frozen object.\r\n */\r\nexport function deepFreeze(data, skipFreezeKeys = [])\r\n{\r\n   /* istanbul ignore if */\r\n   if (typeof data !== 'object') { throw new TypeError(`'data' is not an 'object'.`); }\r\n\r\n   /* istanbul ignore if */\r\n   if (!Array.isArray(skipFreezeKeys)) { throw new TypeError(`'skipFreezeKeys' is not an 'array'.`); }\r\n\r\n   return _deepFreeze(data, skipFreezeKeys);\r\n}\r\n\r\n/**\r\n * Performs a naive depth traversal of an object / array. The data structure _must not_ have circular references.\r\n * The result of the callback function is used to modify in place the given data.\r\n *\r\n * @param {object|Array}   data - An object or array.\r\n *\r\n * @param {Function}       func - A callback function to process leaf values in children arrays or object members.\r\n *\r\n * @param {boolean}        modify - If true then the result of the callback function is used to modify in place\r\n *                                  the given data.\r\n *\r\n * @returns {*} The data object.\r\n */\r\nexport function depthTraverse(data, func, modify = false)\r\n{\r\n   /* istanbul ignore if */\r\n   if (typeof data !== 'object') { throw new TypeError(`'data' is not an 'object'.`); }\r\n\r\n   /* istanbul ignore if */\r\n   if (typeof func !== 'function') { throw new TypeError(`'func' is not a 'function'.`); }\r\n\r\n   return _depthTraverse(data, func, modify);\r\n}\r\n\r\n/**\r\n * Returns a list of accessor keys by traversing the given object.\r\n *\r\n * @param {object}   data - An object to traverse for accessor keys.\r\n *\r\n * @returns {string[]} Accessor list.\r\n */\r\nexport function getAccessorList(data)\r\n{\r\n   if (typeof data !== 'object') { throw new TypeError(`getAccessorList error: 'data' is not an 'object'.`); }\r\n\r\n   return _getAccessorList(data);\r\n}\r\n\r\n/**\r\n * Tests for whether an object is iterable.\r\n *\r\n * @param {object} object - An object.\r\n *\r\n * @returns {boolean} Whether object is iterable.\r\n */\r\nexport function isIterable(object)\r\n{\r\n   if (object === null || object === void 0 || typeof object !== 'object') { return false; }\r\n\r\n   return typeof object[Symbol.iterator] === 'function';\r\n}\r\n\r\n/**\r\n * Tests for whether an object is async iterable.\r\n *\r\n * @param {object} object - An object.\r\n *\r\n * @returns {boolean} Whether object is async iterable.\r\n */\r\nexport function isIterableAsync(object)\r\n{\r\n   if (object === null || object === void 0 || typeof object !== 'object') { return false; }\r\n\r\n   return typeof object[Symbol.asyncIterator] === 'function';\r\n}\r\n\r\n/**\r\n * Tests for whether object is not null and a typeof object.\r\n *\r\n * @param {object} object - An object.\r\n *\r\n * @returns {boolean} Is it an object.\r\n */\r\nexport function isObject(object)\r\n{\r\n   return object !== null && typeof object === 'object';\r\n}\r\n\r\n/**\r\n * Safely returns keys on an object or an empty array if not an object.\r\n *\r\n * @param {object} object - An object.\r\n *\r\n * @returns {string[]} Object keys\r\n */\r\nexport function objectKeys(object)\r\n{\r\n   return object !== null && typeof object === 'object' ? Object.keys(object) : [];\r\n}\r\n\r\n/**\r\n * Safely returns an objects size. Note for String objects unicode is not taken into consideration.\r\n *\r\n * @param {object} object - An object.\r\n *\r\n * @returns {number} Size of object.\r\n */\r\nexport function objectSize(object)\r\n{\r\n   if (object === void 0 || object === null || typeof object !== 'object') { return 0; }\r\n\r\n   const tag = Object.prototype.toString.call(object);\r\n\r\n   if (tag === s_TAG_MAP || tag === s_TAG_SET) { return object.size; }\r\n\r\n   if (tag === s_TAG_STRING) { return object.length; }\r\n\r\n   return Object.keys(object).length;\r\n}\r\n\r\n/**\r\n * Provides a way to safely access an objects data / entries given an accessor string which describes the\r\n * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n * to walk.\r\n *\r\n * @param {object}   data - An object to access entry data.\r\n *\r\n * @param {string}   accessor - A string describing the entries to access.\r\n *\r\n * @param {*}        defaultValue - (Optional) A default value to return if an entry for accessor is not found.\r\n *\r\n * @returns {object} The data object.\r\n */\r\nexport function safeAccess(data, accessor, defaultValue = void 0)\r\n{\r\n   if (typeof data !== 'object') { return defaultValue; }\r\n   if (typeof accessor !== 'string') { return defaultValue; }\r\n\r\n   const access = accessor.split('.');\r\n\r\n   // Walk through the given object by the accessor indexes.\r\n   for (let cntr = 0; cntr < access.length; cntr++)\r\n   {\r\n      // If the next level of object access is undefined or null then return the empty string.\r\n      if (typeof data[access[cntr]] === 'undefined' || data[access[cntr]] === null) { return defaultValue; }\r\n\r\n      data = data[access[cntr]];\r\n   }\r\n\r\n   return data;\r\n}\r\n\r\n/**\r\n * Provides a way to safely batch set an objects data / entries given an array of accessor strings which describe the\r\n * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n * to walk. If value is an object the accessor will be used to access a target value from `value` which is\r\n * subsequently set to `data` by the given operation. If `value` is not an object it will be used as the target\r\n * value to set across all accessors.\r\n *\r\n * @param {object}         data - An object to access entry data.\r\n *\r\n * @param {Array<string>}  accessors - A string describing the entries to access.\r\n *\r\n * @param {object|*}       value - A new value to set if an entry for accessor is found.\r\n *\r\n * @param {string}         [operation='set'] - Operation to perform including: 'add', 'div', 'mult', 'set',\r\n *                                             'set-undefined', 'sub'.\r\n *\r\n * @param {object|*}       [defaultAccessValue=0] - A new value to set if an entry for accessor is found.\r\n *\r\n *\r\n * @param {boolean}  [createMissing=true] - If true missing accessor entries will be created as objects\r\n *                                          automatically.\r\n */\r\nexport function safeBatchSet(data, accessors, value, operation = 'set', defaultAccessValue = 0, createMissing = true)\r\n{\r\n   if (typeof data !== 'object') { throw new TypeError(`safeBatchSet Error: 'data' is not an 'object'.`); }\r\n   if (!Array.isArray(accessors)) { throw new TypeError(`safeBatchSet Error: 'accessors' is not an 'array'.`); }\r\n\r\n   if (typeof value === 'object')\r\n   {\r\n      accessors.forEach((accessor) =>\r\n      {\r\n         const targetValue = safeAccess(value, accessor, defaultAccessValue);\r\n         safeSet(data, accessor, targetValue, operation, createMissing);\r\n      });\r\n   }\r\n   else\r\n   {\r\n      accessors.forEach((accessor) =>\r\n      {\r\n         safeSet(data, accessor, value, operation, createMissing);\r\n      });\r\n   }\r\n}\r\n\r\n/**\r\n * Compares a source object and values of entries against a target object. If the entries in the source object match\r\n * the target object then `true` is returned otherwise `false`. If either object is undefined or null then false\r\n * is returned.\r\n *\r\n * @param {object}   source - Source object.\r\n *\r\n * @param {object}   target - Target object.\r\n *\r\n * @returns {boolean} True if equal.\r\n */\r\nexport function safeEqual(source, target)\r\n{\r\n   if (typeof source === 'undefined' || source === null || typeof target === 'undefined' || target === null)\r\n   {\r\n      return false;\r\n   }\r\n\r\n   const sourceAccessors = getAccessorList(source);\r\n\r\n   for (let cntr = 0; cntr < sourceAccessors.length; cntr++)\r\n   {\r\n      const accessor = sourceAccessors[cntr];\r\n\r\n      const sourceObjectValue = safeAccess(source, accessor);\r\n      const targetObjectValue = safeAccess(target, accessor);\r\n\r\n      if (sourceObjectValue !== targetObjectValue) { return false; }\r\n   }\r\n\r\n   return true;\r\n}\r\n\r\n/**\r\n * Provides a way to safely set an objects data / entries given an accessor string which describes the\r\n * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n * to walk.\r\n *\r\n * @param {object}   data - An object to access entry data.\r\n *\r\n * @param {string}   accessor - A string describing the entries to access.\r\n *\r\n * @param {*}        value - A new value to set if an entry for accessor is found.\r\n *\r\n * @param {string}   [operation='set'] - Operation to perform including: 'add', 'div', 'mult', 'set',\r\n *                                       'set-undefined', 'sub'.\r\n *\r\n * @param {boolean}  [createMissing=true] - If true missing accessor entries will be created as objects\r\n *                                          automatically.\r\n *\r\n * @returns {boolean} True if successful.\r\n */\r\nexport function safeSet(data, accessor, value, operation = 'set', createMissing = true)\r\n{\r\n   if (typeof data !== 'object') { throw new TypeError(`safeSet Error: 'data' is not an 'object'.`); }\r\n   if (typeof accessor !== 'string') { throw new TypeError(`safeSet Error: 'accessor' is not a 'string'.`); }\r\n\r\n   const access = accessor.split('.');\r\n\r\n   // Walk through the given object by the accessor indexes.\r\n   for (let cntr = 0; cntr < access.length; cntr++)\r\n   {\r\n      // If data is an array perform validation that the accessor is a positive integer otherwise quit.\r\n      if (Array.isArray(data))\r\n      {\r\n         const number = (+access[cntr]);\r\n\r\n         if (!Number.isInteger(number) || number < 0) { return false; }\r\n      }\r\n\r\n      if (cntr === access.length - 1)\r\n      {\r\n         switch (operation)\r\n         {\r\n            case 'add':\r\n               data[access[cntr]] += value;\r\n               break;\r\n\r\n            case 'div':\r\n               data[access[cntr]] /= value;\r\n               break;\r\n\r\n            case 'mult':\r\n               data[access[cntr]] *= value;\r\n               break;\r\n\r\n            case 'set':\r\n               data[access[cntr]] = value;\r\n               break;\r\n\r\n            case 'set-undefined':\r\n               if (typeof data[access[cntr]] === 'undefined') { data[access[cntr]] = value; }\r\n               break;\r\n\r\n            case 'sub':\r\n               data[access[cntr]] -= value;\r\n               break;\r\n         }\r\n      }\r\n      else\r\n      {\r\n         // If createMissing is true and the next level of object access is undefined then create a new object entry.\r\n         if (createMissing && typeof data[access[cntr]] === 'undefined') { data[access[cntr]] = {}; }\r\n\r\n         // Abort if the next level is null or not an object and containing a value.\r\n         if (data[access[cntr]] === null || typeof data[access[cntr]] !== 'object') { return false; }\r\n\r\n         data = data[access[cntr]];\r\n      }\r\n   }\r\n\r\n   return true;\r\n}\r\n\r\n/**\r\n * Performs bulk setting of values to the given data object.\r\n *\r\n * @param {object}            data - The data object to set data.\r\n *\r\n * @param {object<string, *>} accessorValues - Object of accessor keys to values to set.\r\n *\r\n * @param {string}            [operation='set'] - Operation to perform including: 'add', 'div', 'mult', 'set', 'sub';\r\n *                                                default (`set`).\r\n *\r\n * @param {boolean}           [createMissing=true] - If true missing accessor entries will be created as objects\r\n *                                                   automatically.\r\n */\r\nexport function safeSetAll(data, accessorValues, operation = 'set', createMissing = true)\r\n{\r\n   if (typeof data !== 'object') { throw new TypeError(`'data' is not an 'object'.`); }\r\n   if (typeof accessorValues !== 'object') { throw new TypeError(`'accessorValues' is not an 'object'.`); }\r\n\r\n   for (const accessor of Object.keys(accessorValues))\r\n   {\r\n      if (!accessorValues.hasOwnProperty(accessor)) { continue; } // eslint-disable-line no-prototype-builtins\r\n\r\n      safeSet(data, accessor, accessorValues[accessor], operation, createMissing);\r\n   }\r\n}\r\n\r\n/**\r\n * Performs bulk validation of data given an object, `validationData`, which describes all entries to test.\r\n *\r\n * @param {object}                           data - The data object to test.\r\n *\r\n * @param {object<string, ValidationEntry>}  validationData - Key is the accessor / value is a validation entry.\r\n *\r\n * @param {string}                           [dataName='data'] - Optional name of data.\r\n *\r\n * @returns {boolean} True if validation passes otherwise an exception is thrown.\r\n */\r\nexport function validate(data, validationData = {}, dataName = 'data')\r\n{\r\n   if (typeof data !== 'object') { throw new TypeError(`'${dataName}' is not an 'object'.`); }\r\n   if (typeof validationData !== 'object') { throw new TypeError(`'validationData' is not an 'object'.`); }\r\n\r\n   let result;\r\n\r\n   for (const key of Object.keys(validationData))\r\n   {\r\n      if (!validationData.hasOwnProperty(key)) { continue; } // eslint-disable-line no-prototype-builtins\r\n\r\n      const entry = validationData[key];\r\n\r\n      switch (entry.test)\r\n      {\r\n         case 'array':\r\n            result = validateArray(data, key, entry, dataName);\r\n            break;\r\n\r\n         case 'entry':\r\n            result = validateEntry(data, key, entry, dataName);\r\n            break;\r\n\r\n         case 'entry|array':\r\n            result = validateEntryOrArray(data, key, entry, dataName);\r\n            break;\r\n      }\r\n   }\r\n\r\n   return result;\r\n}\r\n\r\n/**\r\n * Validates all array entries against potential type and expected tests.\r\n *\r\n * @param {object}            data - The data object to test.\r\n *\r\n * @param {string}            accessor - A string describing the entries to access.\r\n *\r\n * @param {object}            opts - Options object.\r\n *\r\n * @param {string}            [opts.type] - Tests with a typeof check.\r\n *\r\n * @param {Function|Set<*>}   [opts.expected] - Optional function or set of expected values to test against.\r\n *\r\n * @param {string}            [opts.message] - Optional message to include.\r\n *\r\n * @param {boolean}           [opts.required] - When false if the accessor is missing validation is skipped.\r\n *\r\n * @param {boolean}           [opts.error=true] - When true and error is thrown otherwise a boolean is returned.\r\n *\r\n * @param {string}            [dataName='data'] - Optional name of data.\r\n *\r\n * @returns {boolean} True if validation passes otherwise an exception is thrown.\r\n */\r\nexport function validateArray(data, accessor, { type = void 0, expected = void 0, message = void 0, required = true,\r\n error = true } = {}, dataName = 'data')\r\n{\r\n   const dataArray = safeAccess(data, accessor);\r\n\r\n   // A non-required entry is missing so return without validation.\r\n   if (!required && typeof dataArray === 'undefined') { return true; }\r\n\r\n   if (!Array.isArray(dataArray))\r\n   {\r\n      if (error)\r\n      {\r\n         throw _validateError(TypeError, `'${dataName}.${accessor}' is not an 'array'.`);\r\n      }\r\n      else\r\n      {\r\n         return false;\r\n      }\r\n   }\r\n\r\n   if (typeof type === 'string')\r\n   {\r\n      for (let cntr = 0; cntr < dataArray.length; cntr++)\r\n      {\r\n         if (!(typeof dataArray[cntr] === type))\r\n         {\r\n            if (error)\r\n            {\r\n               const dataEntryString = typeof dataArray[cntr] === 'object' ? JSON.stringify(dataArray[cntr]) :\r\n                dataArray[cntr];\r\n\r\n               throw _validateError(TypeError,\r\n                `'${dataName}.${accessor}[${cntr}]': '${dataEntryString}' is not a '${type}'.`);\r\n            }\r\n            else\r\n            {\r\n               return false;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   // If expected is a function then test all array entries against the test function. If expected is a Set then\r\n   // test all array entries for inclusion in the set. Otherwise if expected is a string then test that all array\r\n   // entries as a `typeof` test against expected.\r\n   if (Array.isArray(expected))\r\n   {\r\n      for (let cntr = 0; cntr < dataArray.length; cntr++)\r\n      {\r\n         if (!expected.includes(dataArray[cntr]))\r\n         {\r\n            if (error)\r\n            {\r\n               const dataEntryString = typeof dataArray[cntr] === 'object' ? JSON.stringify(dataArray[cntr]) :\r\n                dataArray[cntr];\r\n\r\n               throw _validateError(Error, `'${dataName}.${accessor}[${cntr}]': '${\r\n                dataEntryString}' is not an expected value: ${JSON.stringify(expected)}.`);\r\n            }\r\n            else\r\n            {\r\n               return false;\r\n            }\r\n         }\r\n      }\r\n   }\r\n   else if (expected instanceof Set)\r\n   {\r\n      for (let cntr = 0; cntr < dataArray.length; cntr++)\r\n      {\r\n         if (!expected.has(dataArray[cntr]))\r\n         {\r\n            if (error)\r\n            {\r\n               const dataEntryString = typeof dataArray[cntr] === 'object' ? JSON.stringify(dataArray[cntr]) :\r\n                dataArray[cntr];\r\n\r\n               throw _validateError(Error, `'${dataName}.${accessor}[${cntr}]': '${\r\n                dataEntryString}' is not an expected value: ${JSON.stringify(expected)}.`);\r\n            }\r\n            else\r\n            {\r\n               return false;\r\n            }\r\n         }\r\n      }\r\n   }\r\n   else if (typeof expected === 'function')\r\n   {\r\n      for (let cntr = 0; cntr < dataArray.length; cntr++)\r\n      {\r\n         try\r\n         {\r\n            const result = expected(dataArray[cntr]);\r\n\r\n            if (typeof result === 'undefined' || !result) { throw new Error(message); }\r\n         }\r\n         catch (err)\r\n         {\r\n            if (error)\r\n            {\r\n               const dataEntryString = typeof dataArray[cntr] === 'object' ? JSON.stringify(dataArray[cntr]) :\r\n                dataArray[cntr];\r\n\r\n               throw _validateError(Error, `'${dataName}.${accessor}[${cntr}]': '${\r\n                dataEntryString}' failed validation: ${err.message}.`);\r\n            }\r\n            else\r\n            {\r\n               return false;\r\n            }\r\n         }\r\n      }\r\n   }\r\n\r\n   return true;\r\n}\r\n\r\n/**\r\n * Validates data entry with a typeof check and potentially tests against the values in any given expected set.\r\n *\r\n * @param {object}            data - The object data to validate.\r\n *\r\n * @param {string}            accessor - A string describing the entries to access.\r\n *\r\n * @param {object}            opts - Options object\r\n *\r\n * @param {string}            [opts.type] - Tests with a typeof check.\r\n *\r\n * @param {Function|Set<*>}   [opts.expected] - Optional function or set of expected values to test against.\r\n *\r\n * @param {string}            [opts.message] - Optional message to include.\r\n *\r\n * @param {boolean}           [opts.required=true] - When false if the accessor is missing validation is skipped.\r\n *\r\n * @param {boolean}           [opts.error=true] - When true and error is thrown otherwise a boolean is returned.\r\n *\r\n * @param {string}            [dataName='data'] - Optional name of data.\r\n *\r\n * @returns {boolean} True if validation passes otherwise an exception is thrown.\r\n */\r\nexport function validateEntry(data, accessor, { type = void 0, expected = void 0, message = void 0, required = true,\r\n error = true } = {}, dataName = 'data')\r\n{\r\n   const dataEntry = safeAccess(data, accessor);\r\n\r\n   // A non-required entry is missing so return without validation.\r\n   if (!required && typeof dataEntry === 'undefined') { return true; }\r\n\r\n   if (type && typeof dataEntry !== type)\r\n   {\r\n      if (error)\r\n      {\r\n         throw _validateError(TypeError, `'${dataName}.${accessor}' is not a '${type}'.`);\r\n      }\r\n      else\r\n      {\r\n         return false;\r\n      }\r\n   }\r\n\r\n   if ((expected instanceof Set && !expected.has(dataEntry)) ||\r\n    (Array.isArray(expected) && !expected.includes(dataEntry)))\r\n   {\r\n      if (error)\r\n      {\r\n         const dataEntryString = typeof dataEntry === 'object' ? JSON.stringify(dataEntry) : dataEntry;\r\n\r\n         throw _validateError(Error, `'${dataName}.${accessor}': '${dataEntryString}' is not an expected value: ${\r\n          JSON.stringify(expected)}.`);\r\n      }\r\n      else\r\n      {\r\n         return false;\r\n      }\r\n   }\r\n   else if (typeof expected === 'function')\r\n   {\r\n      try\r\n      {\r\n         const result = expected(dataEntry);\r\n\r\n         if (typeof result === 'undefined' || !result) { throw new Error(message); }\r\n      }\r\n      catch (err)\r\n      {\r\n         if (error)\r\n         {\r\n            const dataEntryString = typeof dataEntry === 'object' ? JSON.stringify(dataEntry) : dataEntry;\r\n\r\n            throw _validateError(Error, `'${dataName}.${accessor}': '${dataEntryString}' failed to validate: ${\r\n             err.message}.`);\r\n         }\r\n         else\r\n         {\r\n            return false;\r\n         }\r\n      }\r\n   }\r\n\r\n   return true;\r\n}\r\n\r\n/**\r\n * Dispatches validation of data entry to string or array validation depending on data entry type.\r\n *\r\n * @param {object}            data - The data object to test.\r\n *\r\n * @param {string}            accessor - A string describing the entries to access.\r\n *\r\n * @param {ValidationEntry}   [entry] - A validation entry.\r\n *\r\n * @param {string}            [dataName='data'] - Optional name of data.\r\n *\r\n * @returns {boolean} True if validation passes otherwise an exception is thrown.\r\n */\r\nexport function validateEntryOrArray(data, accessor, entry, dataName = 'data')\r\n{\r\n   const dataEntry = safeAccess(data, accessor);\r\n\r\n   let result;\r\n\r\n   if (Array.isArray(dataEntry))\r\n   {\r\n      result = validateArray(data, accessor, entry, dataName);\r\n   }\r\n   else\r\n   {\r\n      result = validateEntry(data, accessor, entry, dataName);\r\n   }\r\n\r\n   return result;\r\n}\r\n\r\n// Module private ---------------------------------------------------------------------------------------------------\r\n\r\n/**\r\n * Private implementation of depth traversal.\r\n *\r\n * @param {object|Array}   data - An object or array.\r\n *\r\n * @param {string[]}       skipFreezeKeys - An array of strings indicating keys of objects to not freeze.\r\n *\r\n * @returns {*} The frozen object.\r\n * @ignore\r\n * @private\r\n */\r\nfunction _deepFreeze(data, skipFreezeKeys)\r\n{\r\n   if (Array.isArray(data))\r\n   {\r\n      for (let cntr = 0; cntr < data.length; cntr++) { _deepFreeze(data[cntr], skipFreezeKeys); }\r\n   }\r\n   else if (typeof data === 'object')\r\n   {\r\n      for (const key in data)\r\n      {\r\n         // eslint-disable-next-line no-prototype-builtins\r\n         if (data.hasOwnProperty(key) && !skipFreezeKeys.includes(key)) { _deepFreeze(data[key], skipFreezeKeys); }\r\n      }\r\n   }\r\n\r\n   return Object.freeze(data);\r\n}\r\n\r\n/**\r\n * Private implementation of depth traversal.\r\n *\r\n * @param {object|Array}   data - An object or array.\r\n *\r\n * @param {Function}       func - A callback function to process leaf values in children arrays or object members.\r\n *\r\n * @param {boolean}        modify - If true then the result of the callback function is used to modify in place\r\n *                                  the given data.\r\n *\r\n * @returns {*} The data object.\r\n * @ignore\r\n * @private\r\n */\r\nfunction _depthTraverse(data, func, modify)\r\n{\r\n   if (modify)\r\n   {\r\n      if (Array.isArray(data))\r\n      {\r\n         for (let cntr = 0; cntr < data.length; cntr++)\r\n         {\r\n            data[cntr] = _depthTraverse(data[cntr], func, modify);\r\n         }\r\n      }\r\n      else if (typeof data === 'object')\r\n      {\r\n         for (const key in data)\r\n         {\r\n            // eslint-disable-next-line no-prototype-builtins\r\n            if (data.hasOwnProperty(key)) { data[key] = _depthTraverse(data[key], func, modify); }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         data = func(data);\r\n      }\r\n   }\r\n   else\r\n   {\r\n      if (Array.isArray(data))\r\n      {\r\n         for (let cntr = 0; cntr < data.length; cntr++) { _depthTraverse(data[cntr], func, modify); }\r\n      }\r\n      else if (typeof data === 'object')\r\n      {\r\n         for (const key in data)\r\n         {\r\n            // eslint-disable-next-line no-prototype-builtins\r\n            if (data.hasOwnProperty(key)) { _depthTraverse(data[key], func, modify); }\r\n         }\r\n      }\r\n      else\r\n      {\r\n         func(data);\r\n      }\r\n   }\r\n\r\n   return data;\r\n}\r\n\r\n/**\r\n * Private implementation of `getAccessorList`.\r\n *\r\n * @param {object}   data - An object to traverse.\r\n *\r\n * @returns {string[]} Accessor list.\r\n * @ignore\r\n * @private\r\n */\r\nfunction _getAccessorList(data)\r\n{\r\n   const accessors = [];\r\n\r\n   for (const key in data)\r\n   {\r\n      if (data.hasOwnProperty(key)) // eslint-disable-line no-prototype-builtins\r\n      {\r\n         if (typeof data[key] === 'object')\r\n         {\r\n            const childKeys = _getAccessorList(data[key]);\r\n\r\n            childKeys.forEach((childKey) =>\r\n            {\r\n               accessors.push(Array.isArray(childKey) ? `${key}.${childKey.join('.')}` : `${key}.${childKey}`);\r\n            });\r\n         }\r\n         else\r\n         {\r\n            accessors.push(key);\r\n         }\r\n      }\r\n   }\r\n\r\n   return accessors;\r\n}\r\n\r\n/**\r\n * Creates a new error of type `clazz` adding the field `_objectValidateError` set to true.\r\n *\r\n * @param {Error}    clazz - Error class to instantiate.\r\n *\r\n * @param {string}   message - An error message.\r\n *\r\n * @returns {*} Error of the clazz.\r\n * @ignore\r\n * @private\r\n */\r\nfunction _validateError(clazz, message = void 0)\r\n{\r\n   const error = new clazz(message);\r\n   error._objectValidateError = true;\r\n   return error;\r\n}\r\n","/**\r\n * Provides a helper class for {@link SvelteApplication} by combining all methods that work on the {@link SvelteData[]}\r\n * of mounted components. This class is instantiated and can be retrieved by the getter `svelte` via SvelteApplication.\r\n */\r\nclass GetSvelteData\r\n{\r\n   /**\r\n    * @type {ApplicationShell|null[]}\r\n    */\r\n   #applicationShellHolder;\r\n\r\n   /**\r\n    * @type {SvelteData[]}\r\n    */\r\n   #svelteData;\r\n\r\n   /**\r\n    * Keep a direct reference to the SvelteData array in an associated {@link SvelteApplication}.\r\n    *\r\n    * @param {ApplicationShell|null[]}  applicationShellHolder - A reference to the ApplicationShell array.\r\n    *\r\n    * @param {SvelteData[]}  svelteData - A reference to the SvelteData array of mounted components.\r\n    */\r\n   constructor(applicationShellHolder, svelteData)\r\n   {\r\n      this.#applicationShellHolder = applicationShellHolder;\r\n      this.#svelteData = svelteData;\r\n   }\r\n\r\n   /**\r\n    * Returns any mounted {@link ApplicationShell}.\r\n    *\r\n    * @returns {ApplicationShell|null} Any mounted application shell.\r\n    */\r\n   get applicationShell() { return this.#applicationShellHolder[0]; }\r\n\r\n   /**\r\n    * Returns the indexed Svelte component.\r\n    *\r\n    * @param {number}   index -\r\n    *\r\n    * @returns {object} The loaded Svelte component.\r\n    */\r\n   component(index)\r\n   {\r\n      const data = this.#svelteData[index];\r\n      return typeof data === 'object' ? data?.component : void 0;\r\n   }\r\n\r\n   /**\r\n    * Returns the Svelte component entries iterator.\r\n    *\r\n    * @returns {Generator<(number|*)[], void, *>} Svelte component entries iterator.\r\n    * @yields\r\n    */\r\n   *componentEntries()\r\n   {\r\n      for (let cntr = 0; cntr < this.#svelteData.length; cntr++)\r\n      {\r\n         yield [cntr, this.#svelteData[cntr].component];\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Returns the Svelte component values iterator.\r\n    *\r\n    * @returns {Generator<*, void, *>} Svelte component values iterator.\r\n    * @yields\r\n    */\r\n   *componentValues()\r\n   {\r\n      for (let cntr = 0; cntr < this.#svelteData.length; cntr++)\r\n      {\r\n         yield this.#svelteData[cntr].component;\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Returns the indexed SvelteData entry.\r\n    *\r\n    * @param {number}   index -\r\n    *\r\n    * @returns {object} The loaded Svelte config + component.\r\n    */\r\n   data(index)\r\n   {\r\n      return this.#svelteData[index];\r\n   }\r\n\r\n   /**\r\n    * Returns the SvelteData entries iterator.\r\n    *\r\n    * @returns {IterableIterator<[number, Object]>} SvelteData entries iterator.\r\n    */\r\n   dataEntries()\r\n   {\r\n      return this.#svelteData.entries();\r\n   }\r\n\r\n   /**\r\n    * Returns the SvelteData values iterator.\r\n    *\r\n    * @returns {IterableIterator<Object>} SvelteData values iterator.\r\n    */\r\n   dataValues()\r\n   {\r\n      return this.#svelteData.values();\r\n   }\r\n\r\n   get length()\r\n   {\r\n      return this.#svelteData.length;\r\n   }\r\n}\r\n\r\nObject.freeze(GetSvelteData);\r\n\r\nexport { GetSvelteData };\r\n\r\n/**\r\n * @typedef {object} SvelteData\r\n *\r\n * @property {object}            config -\r\n *\r\n * @property {SvelteComponent}   component -\r\n *\r\n * @property {HTMLElement}       element -\r\n *\r\n * @property {Eventbus}          eventbus -\r\n */","import { derived, writable }     from 'svelte/store';\r\nimport { safeAccess, safeSet }   from '@typhonjs-utils/object';\r\n\r\nimport {\r\n   hasGetter,\r\n   isApplicationShell,\r\n   outroAndDestroy,\r\n   parseSvelteConfig }           from '@typhonjs-fvtt/svelte/util';\r\n\r\nimport { GetSvelteData }         from './GetSvelteData.js';\r\n\r\n/**\r\n * Provides a Svelte aware extension to Application to control the app lifecycle appropriately. You can declaratively\r\n * load one or more components from `defaultOptions`. For the time being please refer to this temporary demo code\r\n * in `typhonjs-quest-log` for examples of how to declare Svelte components.\r\n * {@link https://github.com/typhonjs-fvtt/typhonjs-quest-log/tree/master/src/view/demo}\r\n *\r\n * A repository of demos will be available soon.\r\n */\r\nexport class SvelteApplication extends Application\r\n{\r\n   /**\r\n    * Stores the first mounted component which follows the application shell contract.\r\n    *\r\n    * @type {ApplicationShell|null[]} Application shell.\r\n    */\r\n   #applicationShellHolder = [null];\r\n\r\n   /**\r\n    * Get the current application shell.\r\n    *\r\n    * @returns {ApplicationShell|null} The first mounted component which follows the application shell contract.\r\n    */\r\n   get #applicationShell() { return this.#applicationShellHolder[0]; }\r\n\r\n   /**\r\n    * Stores the target element which may not necessarily be the main element.\r\n    *\r\n    * @type {HTMLElement}\r\n    */\r\n   #elementTarget = null;\r\n\r\n   /**\r\n    * Stores the content element which is set for application shells.\r\n    *\r\n    * @type {HTMLElement}\r\n    */\r\n   #elementContent = null;\r\n\r\n   /**\r\n    * The Application option store which is injected into mounted Svelte component context under the `external` key.\r\n    *\r\n    * @type {StoreAppOptions}\r\n    */\r\n   #storeAppOptions;\r\n\r\n   /**\r\n    * Stores the update function for `#storeAppOptions`.\r\n    *\r\n    * @type {import('svelte/store').Writable.update}\r\n    */\r\n   #storeAppOptionsUpdate;\r\n\r\n   /**\r\n    * The UI option store which is injected into mounted Svelte component context under the `external` key.\r\n    *\r\n    * @type {StoreUIOptions}\r\n    */\r\n   #storeUIOptions;\r\n\r\n   /**\r\n    * Stores the update function for `#storeUIOptions`.\r\n    *\r\n    * @type {import('svelte/store').Writable.update}\r\n    */\r\n   #storeUIOptionsUpdate;\r\n\r\n   /**\r\n    * Stores the unsubscribe functions from local store subscriptions.\r\n    *\r\n    * @type {import('svelte/store').Unsubscriber[]}\r\n    */\r\n   #storeUnsubscribe = [];\r\n\r\n   /**\r\n    * Stores SvelteData entries with instantiated Svelte components.\r\n    *\r\n    * @type {SvelteData[]}\r\n    */\r\n   #svelteData = [];\r\n\r\n   /**\r\n    * Provides a helper class that combines multiple methods for interacting with the mounted components tracked in\r\n    * {@link #svelteData}.\r\n    *\r\n    * @type {GetSvelteData}\r\n    */\r\n   #getSvelteData = new GetSvelteData(this.#applicationShellHolder, this.#svelteData);\r\n\r\n   /**\r\n    * @inheritDoc\r\n    */\r\n   constructor(options)\r\n   {\r\n      super(options);\r\n\r\n      this.#storesInitialize();\r\n   }\r\n\r\n   /**\r\n    * Specifies the default options that SvelteApplication supports.\r\n    *\r\n    * @returns {object} options - Application options.\r\n    * @see https://foundryvtt.com/api/Application.html#options\r\n    */\r\n   static get defaultOptions()\r\n   {\r\n      return foundry.utils.mergeObject(super.defaultOptions, {\r\n         draggable: true,              // If true then application shells are draggable.\r\n         headerButtonNoLabel: false,   // If true then header button labels are removed for application shells.\r\n         jqueryCloseAnimation: true,   // If false the Foundry JQuery close animation is not run.\r\n         zIndex: null                  // When set the zIndex is manually controlled.\r\n      });\r\n   }\r\n\r\n   /**\r\n    * Returns the draggable app option.\r\n    *\r\n    * @returns {boolean} Draggable app option.\r\n    */\r\n   get draggable() { return this.options.draggable; }\r\n\r\n   /**\r\n    * Returns the content element if an application shell is mounted.\r\n    *\r\n    * @returns {HTMLElement} Content element.\r\n    */\r\n   get elementContent() { return this.#elementContent; }\r\n\r\n   /**\r\n    * Returns the target element or main element if no target defined.\r\n    *\r\n    * @returns {HTMLElement} Target element.\r\n    */\r\n   get elementTarget() { return this.#elementTarget; }\r\n\r\n   /**\r\n    * @inheritDoc\r\n    */\r\n   get popOut() { return super.popOut; }\r\n\r\n   /**\r\n    * Returns the resizable option.\r\n    *\r\n    * @returns {boolean} Resizable app option.\r\n    */\r\n   get resizable() { return this.options.resizable; }\r\n\r\n   /**\r\n    * Returns the Svelte helper class w/ various methods to access mounted Svelte components.\r\n    *\r\n    * @returns {GetSvelteData} GetSvelteData\r\n    */\r\n   get svelte() { return this.#getSvelteData; }\r\n\r\n   /**\r\n    * Returns the title accessor from the parent Application class.\r\n    * TODO: Application v2; note that super.title localizes `this.options.title`; IMHO it shouldn't.\r\n    *\r\n    * @returns {string} Title.\r\n    */\r\n   get title() { return super.title; }\r\n\r\n   /**\r\n    * Returns the zIndex app option.\r\n    *\r\n    * @returns {number} z-index app option.\r\n    */\r\n   get zIndex() { return this.options.zIndex; }\r\n\r\n   /**\r\n    * Sets `this.options.draggable` which is reactive for application shells.\r\n    *\r\n    * @param {boolean}  draggable - Sets the draggable option.\r\n    */\r\n   set draggable(draggable)\r\n   {\r\n      if (typeof draggable === 'boolean') { this.setOptions('draggable', draggable); }\r\n   }\r\n\r\n   /**\r\n    * Sets the content element.\r\n    *\r\n    * @param {HTMLElement} content - Content element.\r\n    */\r\n   set elementContent(content)\r\n   {\r\n      if (!(content instanceof HTMLElement))\r\n      {\r\n         throw new TypeError(`SvelteApplication - set elementContent error: 'content' is not an HTMLElement.`);\r\n      }\r\n      this.#elementContent = content;\r\n   }\r\n\r\n   /**\r\n    * Sets the target element or main element if no target defined.\r\n    *\r\n    * @param {HTMLElement} target - Target element.\r\n    */\r\n   set elementTarget(target)\r\n   {\r\n      if (!(target instanceof HTMLElement))\r\n      {\r\n         throw new TypeError(`SvelteApplication - set elementTarget error: 'target' is not an HTMLElement.`);\r\n      }\r\n      this.#elementTarget = target;\r\n   }\r\n\r\n   /**\r\n    * Sets `this.options.popOut` which is reactive for application shells. This will add / remove this application\r\n    * from `ui.windows`.\r\n    *\r\n    * @param {boolean}  popOut - Sets the popOut option.\r\n    */\r\n   set popOut(popOut)\r\n   {\r\n      if (typeof popOut === 'boolean') { this.setOptions('popOut', popOut); }\r\n   }\r\n\r\n   /**\r\n    * Sets `this.options.resizable` which is reactive for application shells.\r\n    *\r\n    * @param {boolean}  resizable - Sets the resizable option.\r\n    */\r\n   set resizable(resizable)\r\n   {\r\n      if (typeof resizable === 'boolean') { this.setOptions('resizable', resizable); }\r\n   }\r\n\r\n   /**\r\n    * Sets `this.options.title` which is reactive for application shells.\r\n    *\r\n    * @param {string}   title - Application title; will be localized, so a translation key is fine.\r\n    */\r\n   set title(title)\r\n   {\r\n      if (typeof title === 'string') { this.setOptions('title', title); }\r\n   }\r\n\r\n   /**\r\n    * Sets `this.options.zIndex` which is reactive for application shells.\r\n    *\r\n    * @param {number}   zIndex - Application z-index.\r\n    */\r\n   set zIndex(zIndex)\r\n   {\r\n      this.setOptions('zIndex', Number.isInteger(zIndex) ? zIndex : null);\r\n   }\r\n\r\n   /**\r\n    * Note: This method is fully overridden and duplicated as Svelte components need to be destroyed manually and the\r\n    * best visual result is to destroy them after the default JQuery slide up animation occurs, but before the element\r\n    * is removed from the DOM.\r\n    *\r\n    * If you destroy the Svelte components before the slide up animation the Svelte elements are removed immediately\r\n    * from the DOM. The purpose of overriding ensures the slide up animation is always completed before\r\n    * the Svelte components are destroyed and then the element is removed from the DOM.\r\n    *\r\n    * Close the application and un-register references to it within UI mappings.\r\n    * This function returns a Promise which resolves once the window closing animation concludes\r\n    *\r\n    * @param {object}   options - Optional parameters.\r\n    *\r\n    * @param {boolean}  options.force - Force close regardless of render state.\r\n    *\r\n    * @returns {Promise<void|number>}    A Promise which resolves once the application is closed\r\n    */\r\n   async close(options = {})\r\n   {\r\n      const states = Application.RENDER_STATES;\r\n      if (!options.force && ![states.RENDERED, states.ERROR].includes(this._state)) { return; }\r\n\r\n      // Unsubscribe from any local stores.\r\n      this.#storesUnsubscribe();\r\n\r\n      this._state = states.CLOSING;\r\n\r\n      /**\r\n       * Get the element.\r\n       *\r\n       * @type {JQuery}\r\n       */\r\n      const el = $(this.#elementTarget);\r\n      if (!el) { return this._state = states.CLOSED; }\r\n\r\n      // Dispatch Hooks for closing the base and subclass applications\r\n      for (const cls of this.constructor._getInheritanceChain())\r\n      {\r\n         /**\r\n          * A hook event that fires whenever this Application is closed.\r\n          *\r\n          * @param {Application} app                     The Application instance being closed\r\n          *\r\n          * @param {jQuery[]} html                       The application HTML when it is closed\r\n          *\r\n          * @function closeApplication\r\n          *\r\n          * @memberof hookEvents\r\n          */\r\n         Hooks.call(`close${cls.name}`, this, el);\r\n      }\r\n\r\n      // If options `jqueryCloseAnimation` is false then do not execute the standard JQuery slide up animation.\r\n      // This allows Svelte components to provide any out transition. Application shells will automatically set\r\n      // `jqueryCloseAnimation` based on any out transition set or unset.\r\n      const animate = typeof this.options.jqueryCloseAnimation === 'boolean' ? this.options.jqueryCloseAnimation : true;\r\n      if (animate)\r\n      {\r\n         // Await on JQuery to slide up the main element.\r\n         el[0].style.minHeight = '0';\r\n         await new Promise((resolve) => { el.slideUp(200, () => resolve()); });\r\n      }\r\n\r\n      // Stores the Promises returned from running outro transitions and destroying each Svelte component.\r\n      const svelteDestroyPromises = [];\r\n\r\n      // Manually invoke the destroy callbacks for all Svelte components.\r\n      for (const entry of this.#svelteData)\r\n      {\r\n         // Use `outroAndDestroy` to run outro transitions before destroying.\r\n         svelteDestroyPromises.push(outroAndDestroy(entry.component));\r\n\r\n         // If any proxy eventbus has been added then remove all event registrations from the component.\r\n         const eventbus = entry.config.eventbus;\r\n         if (typeof eventbus === 'object' && typeof eventbus.off === 'function')\r\n         {\r\n            eventbus.off();\r\n            entry.config.eventbus = void 0;\r\n         }\r\n      }\r\n\r\n      // Await all Svelte components to destroy.\r\n      await Promise.all(svelteDestroyPromises);\r\n\r\n      // Reset SvelteData like this to maintain reference to GetSvelteData / `this.svelte`.\r\n      this.#svelteData.length = 0;\r\n\r\n      // Use JQuery to remove `this._element` from the DOM. Most SvelteComponents have already removed it.\r\n      el.remove();\r\n\r\n      // Clean up data\r\n      this.#applicationShellHolder[0] = null;\r\n      this._element = null;\r\n      this.#elementContent = null;\r\n      this.#elementTarget = null;\r\n      delete ui.windows[this.appId];\r\n      this._minimized = false;\r\n      this._scrollPositions = null;\r\n      this._state = states.CLOSED;\r\n\r\n      // Update the minimized UI store options.\r\n      this.#storeUIOptionsUpdate((storeOptions) => foundry.utils.mergeObject(storeOptions, {\r\n         minimized: this._minimized\r\n      }));\r\n   }\r\n\r\n   /**\r\n    * Provides a way to safely get this applications options given an accessor string which describes the\r\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n    * to walk.\r\n    *\r\n    * // TODO DOCUMENT the accessor in more detail.\r\n    *\r\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\r\n    *\r\n    * @param {*}        [defaultValue] - A default value returned if the accessor is not found.\r\n    *\r\n    * @returns {*} Value at the accessor.\r\n    */\r\n   getOptions(accessor, defaultValue)\r\n   {\r\n      return safeAccess(this.options, accessor, defaultValue);\r\n   }\r\n\r\n   /**\r\n    * Inject the Svelte components defined in `this.options.svelte`. The Svelte component can attach to the existing\r\n    * pop-out of Application or provide no template and render into a document fragment which is then attached to the\r\n    * DOM.\r\n    *\r\n    * @param {JQuery} html -\r\n    *\r\n    * @override\r\n    * @inheritDoc\r\n    */\r\n   _injectHTML(html)\r\n   {\r\n      if (this.popOut && html.length === 0 && Array.isArray(this.options.svelte))\r\n      {\r\n         throw new Error(\r\n          'SvelteApplication - _injectHTML - A popout app with no template can only support one Svelte component.');\r\n      }\r\n\r\n      // Make sure the store is updated with the latest header buttons. Also allows filtering buttons before display.\r\n      this.updateHeaderButtons();\r\n\r\n      if (Array.isArray(this.options.svelte))\r\n      {\r\n         for (const svelteConfig of this.options.svelte)\r\n         {\r\n            const svelteData = s_LOAD_CONFIG(this, html, svelteConfig, this.#storeAppOptions, this.#storeUIOptions);\r\n\r\n            if (isApplicationShell(svelteData.component))\r\n            {\r\n               if (this.#applicationShell !== null)\r\n               {\r\n                  throw new Error(\r\n                   `SvelteApplication - _injectHTML - An application shell is already mounted; offending config: \r\n                    ${JSON.stringify(svelteConfig)}`);\r\n               }\r\n\r\n               this.#applicationShellHolder[0] = svelteData.component;\r\n            }\r\n\r\n            this.#svelteData.push(svelteData);\r\n         }\r\n      }\r\n      else if (typeof this.options.svelte === 'object')\r\n      {\r\n         const svelteData = s_LOAD_CONFIG(this, html, this.options.svelte, this.#storeAppOptions, this.#storeUIOptions);\r\n\r\n         if (isApplicationShell(svelteData.component))\r\n         {\r\n            // A sanity check as shouldn't hit this case as only one component is being mounted.\r\n            if (this.#applicationShell !== null)\r\n            {\r\n               throw new Error(\r\n                `SvelteApplication - _injectHTML - An application shell is already mounted; offending config: \r\n                 ${JSON.stringify(this.options.svelte)}`);\r\n            }\r\n\r\n            this.#applicationShellHolder[0] = svelteData.component;\r\n         }\r\n\r\n         this.#svelteData.push(svelteData);\r\n      }\r\n      // TODO EVALUATE; COMMENTED OUT WHILE WORKING ON HandlebarsApplication.\r\n      // else\r\n      // {\r\n      //    throw new TypeError(`SvelteApplication - _injectHTML - this.options.svelte not an array or object.`);\r\n      // }\r\n\r\n      // Detect if this is a synthesized DocumentFragment.\r\n      const isDocumentFragment = html.length && html[0] instanceof DocumentFragment;\r\n\r\n      // If any of the Svelte components mounted directly targets an HTMLElement then do not inject HTML.\r\n      let injectHTML = true;\r\n      for (const svelteData of this.#svelteData)\r\n      {\r\n         if (!svelteData.injectHTML) { injectHTML = false; break; }\r\n      }\r\n      if (injectHTML) { super._injectHTML(html); }\r\n\r\n      if (this.#applicationShell !== null)\r\n      {\r\n         this._element = $(this.#applicationShell.elementRoot);\r\n\r\n         // Detect if the application shell exports an `elementContent` accessor.\r\n         this.#elementContent = hasGetter(this.#applicationShell, 'elementContent') ?\r\n          this.#applicationShell.elementContent : null;\r\n\r\n         // Detect if the application shell exports an `elementTarget` accessor.\r\n         this.#elementTarget = hasGetter(this.#applicationShell, 'elementTarget') ?\r\n          this.#applicationShell.elementTarget : null;\r\n      }\r\n      else if (isDocumentFragment) // Set the element of the app to the first child element in order of Svelte components mounted.\r\n      {\r\n         for (const svelteData of this.#svelteData)\r\n         {\r\n            if (svelteData.element instanceof HTMLElement)\r\n            {\r\n               this._element = $(svelteData.element);\r\n               break;\r\n            }\r\n         }\r\n      }\r\n\r\n      // Potentially retrieve a specific target element if `selectorTarget` is defined otherwise make the target the\r\n      // main element.\r\n      if (this.#elementTarget === null)\r\n      {\r\n         const element = typeof this.options.selectorTarget === 'string' ?\r\n          this._element.find(this.options.selectorTarget) : this._element;\r\n\r\n         this.#elementTarget = element[0];\r\n      }\r\n\r\n      // TODO VERIFY THIS CHECK ESPECIALLY `this.#elementTarget.length === 0`.\r\n      if (this.#elementTarget === null || this.#elementTarget === void 0 || this.#elementTarget.length === 0)\r\n      {\r\n         throw new Error(`SvelteApplication - _injectHTML: Target element '${this.options.selectorTarget}' not found.`);\r\n      }\r\n\r\n      // Subscribe to local store handling. Defer to next clock tick for the render cycle to complete.\r\n      setTimeout(() => this.#storesSubscribe(), 0);\r\n\r\n      this.onSvelteMount({ element: this._element[0], elementContent: this.#elementContent, elementTarget:\r\n       this.#elementTarget });\r\n   }\r\n\r\n   /**\r\n    * Provides a mechanism to update the UI options store for minimized.\r\n    *\r\n    * Note: the sanity check is duplicated from {@link Application.maximize} and the store is updated _before_\r\n    * the actual parent method is invoked. This allows application shells to remove / show any resize handlers\r\n    * correctly.\r\n    *\r\n    * @inheritDoc\r\n    */\r\n   async maximize()\r\n   {\r\n      if (!this.popOut || [false, null].includes(this._minimized)) { return; }\r\n\r\n      this.#storeUIOptionsUpdate((options) => foundry.utils.mergeObject(options, { minimized: false }));\r\n\r\n      return super.maximize();\r\n   }\r\n\r\n   /**\r\n    * Provides a mechanism to update the UI options store for minimized.\r\n    *\r\n    * Note: the sanity check is duplicated from {@link Application.minimize} and the store is updated _before_\r\n    * the actual parent method is invoked. This allows application shells to remove / show any resize handlers\r\n    * correctly.\r\n    *\r\n    * @inheritDoc\r\n    */\r\n   async minimize()\r\n   {\r\n      if (!this.rendered || !this.popOut || [true, null].includes(this._minimized)) { return; }\r\n\r\n      this.#storeUIOptionsUpdate((options) => foundry.utils.mergeObject(options, { minimized: true }));\r\n\r\n      return super.minimize();\r\n   }\r\n\r\n   /**\r\n    * Provides a way to merge `options` into this applications options and update the appOptions store.\r\n    *\r\n    * @param {object}   options - The options object to merge with `this.options`.\r\n    */\r\n   mergeOptions(options)\r\n   {\r\n      this.#storeAppOptionsUpdate((instanceOptions) => foundry.utils.mergeObject(instanceOptions, options));\r\n   }\r\n\r\n   /**\r\n    * Provides a callback after all Svelte components are initialized.\r\n    *\r\n    * @param {object}      [opts] - Optional parameters.\r\n    *\r\n    * @param {HTMLElement} [opts.element] - HTMLElement container for main application element.\r\n    *\r\n    * @param {HTMLElement} [opts.elementContent] - HTMLElement container for content area of application shells.\r\n    *\r\n    * @param {HTMLElement} [opts.elementTarget] - HTMLElement container for main application target element.\r\n    */\r\n   onSvelteMount({ element, elementContent, elementTarget }) {} // eslint-disable-line no-unused-vars\r\n\r\n   /**\r\n    * Override replacing HTML as Svelte components control the rendering process. Only potentially change the outer\r\n    * application frame / title for pop-out applications.\r\n    *\r\n    * @override\r\n    * @inheritDoc\r\n    */\r\n   _replaceHTML(element, html)  // eslint-disable-line no-unused-vars\r\n   {\r\n      if (!element.length) { return; }\r\n\r\n      this.updateHeaderButtons();\r\n\r\n   }\r\n\r\n   /**\r\n    * Render the inner application content. Only render a template if one is defined otherwise provide an empty\r\n    * JQuery element.\r\n    *\r\n    * @param {Object} data         The data used to render the inner template\r\n    *\r\n    * @returns {Promise.<JQuery>}   A promise resolving to the constructed jQuery object\r\n    *\r\n    * @override\r\n    * @private\r\n    */\r\n   async _renderInner(data)\r\n   {\r\n      const html = typeof this.template === 'string' ? await renderTemplate(this.template, data) :\r\n       document.createDocumentFragment();\r\n\r\n      return $(html);\r\n   }\r\n\r\n   /**\r\n    * Provides a way to safely set this applications options given an accessor string which describes the\r\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n    * to walk.\r\n    *\r\n    * Additionally if an application shell Svelte component is mounted and exports the `appOptions` property then\r\n    * the application options is set to `appOptions` potentially updating the application shell / Svelte component.\r\n    *\r\n    * // TODO DOCUMENT the accessor in more detail.\r\n    *\r\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\r\n    *\r\n    * @param {*}        value - Value to set.\r\n    */\r\n   setOptions(accessor, value)\r\n   {\r\n      const success = safeSet(this.options, accessor, value);\r\n\r\n      // If `this.options` modified then update the app options store.\r\n      if (success)\r\n      {\r\n         this.#storeAppOptionsUpdate(() => this.options);\r\n      }\r\n   }\r\n\r\n   /**\r\n    * Modified Application `setPosition` to support QuestTrackerApp for switchable resizable globalThis.\r\n    * Set the application position and store its new location.\r\n    *\r\n    * @param {object}               [opts] - Optional parameters.\r\n    *\r\n    * @param {number|null}          [opts.left] - The left offset position in pixels\r\n    *\r\n    * @param {number|null}          [opts.top] - The top offset position in pixels\r\n    *\r\n    * @param {number|null}          [opts.width] - The application width in pixels\r\n    *\r\n    * @param {number|string|null}   [opts.height] - The application height in pixels\r\n    *\r\n    * @param {number|null}          [opts.scale] - The application scale as a numeric factor where 1.0 is default\r\n    *\r\n    * @param {boolean}              [opts.noHeight] - When true no element height is modified.\r\n    *\r\n    * @param {boolean}              [opts.noWidth] - When true no element width is modified.\r\n    *\r\n    * @returns {{left: number, top: number, width: number, height: number, scale:number}}\r\n    * The updated position object for the application containing the new values\r\n    */\r\n   setPosition({ left, top, width, height, scale, noHeight = false, noWidth = false } = {})\r\n   {\r\n      const el = this.elementTarget;\r\n      const currentPosition = this.position;\r\n      const styles = globalThis.getComputedStyle(el);\r\n\r\n      // Update width if an explicit value is passed, or if no width value is set on the element\r\n      if (!el.style.width || width)\r\n      {\r\n         const tarW = width || el.offsetWidth;\r\n         const minW = parseInt(styles.minWidth) || MIN_WINDOW_WIDTH;\r\n         const maxW = el.style.maxWidth || globalThis.innerWidth;\r\n         currentPosition.width = width = Math.clamped(tarW, minW, maxW);\r\n\r\n         if (!noWidth) { el.style.width = `${width}px`; }\r\n         if ((width + currentPosition.left) > globalThis.innerWidth) { left = currentPosition.left; }\r\n      }\r\n      width = el.offsetWidth;\r\n\r\n      // Update height if an explicit value is passed, or if no height value is set on the element\r\n      if (!el.style.height || height)\r\n      {\r\n         const tarH = height || (el.offsetHeight + 1);\r\n         const minH = parseInt(styles.minHeight) || MIN_WINDOW_HEIGHT;\r\n         const maxH = el.style.maxHeight || globalThis.innerHeight;\r\n         currentPosition.height = height = Math.clamped(tarH, minH, maxH);\r\n\r\n         if (!noHeight) { el.style.height = `${height}px`; }\r\n         if ((height + currentPosition.top) > globalThis.innerHeight + 1) { top = currentPosition.top - 1; }\r\n      }\r\n      height = el.offsetHeight;\r\n\r\n      // Update Left\r\n      if ((!el.style.left) || Number.isFinite(left))\r\n      {\r\n         const tarL = Number.isFinite(left) ? left : (globalThis.innerWidth - width) / 2;\r\n         const maxL = Math.max(globalThis.innerWidth - width, 0);\r\n         currentPosition.left = left = Math.clamped(tarL, 0, maxL);\r\n         el.style.left = `${left}px`;\r\n      }\r\n\r\n      // Update Top\r\n      if ((!el.style.top) || Number.isFinite(top))\r\n      {\r\n         const tarT = Number.isFinite(top) ? top : (globalThis.innerHeight - height) / 2;\r\n         const maxT = Math.max(globalThis.innerHeight - height, 0);\r\n         currentPosition.top = top = Math.clamped(tarT, 0, maxT);\r\n         el.style.top = `${currentPosition.top}px`;\r\n      }\r\n\r\n      // Update Scale\r\n      if (scale)\r\n      {\r\n         currentPosition.scale = Math.max(scale, 0);\r\n         if (scale === 1) { el.style.transform = \"\"; }\r\n         else { el.style.transform = `scale(${scale})`; }\r\n      }\r\n\r\n      // Return the updated position object\r\n      return currentPosition;\r\n   }\r\n\r\n   /**\r\n    * Initializes the Svelte stores and derived stores for the application options and UI state.\r\n    *\r\n    * While writable stores are created the update method is stored in private variables locally and derived Readable\r\n    * stores are provided for essential options which are commonly used.\r\n    *\r\n    * These stores are injected into all Svelte components mounted under the `external` context: `storeAppOptions` and\r\n    * ` storeUIOptions`.\r\n    */\r\n   #storesInitialize()\r\n   {\r\n      const writtableAppOptions = writable(this.options);\r\n\r\n      // Keep the update function locally, but make the store essentially readable.\r\n      this.#storeAppOptionsUpdate = writtableAppOptions.update;\r\n\r\n      /**\r\n       * @type {StoreAppOptions}\r\n       */\r\n      const storeAppOptions = {\r\n         subscribe: writtableAppOptions.subscribe,\r\n\r\n         draggable: derived(writtableAppOptions, ($options, set) => set($options.draggable)),\r\n         minimizable: derived(writtableAppOptions, ($options, set) => set($options.minimizable)),\r\n         popOut: derived(writtableAppOptions, ($options, set) => set($options.popOut)),\r\n         resizable: derived(writtableAppOptions, ($options, set) => set($options.resizable)),\r\n         title: derived(writtableAppOptions, ($options, set) => set($options.title)),\r\n         zIndex: derived(writtableAppOptions,\r\n          ($options, set) => set(Number.isInteger($options.zIndex) ? $options.zIndex : null))\r\n      };\r\n\r\n      Object.freeze(storeAppOptions);\r\n\r\n      this.#storeAppOptions = storeAppOptions;\r\n\r\n      // Create a store for UI state data.\r\n      const writableUIOptions = writable({\r\n         headerButtons: [],\r\n         minimized: this._minimized\r\n      });\r\n\r\n      // Keep the update function locally, but make the store essentially readable.\r\n      this.#storeUIOptionsUpdate = writableUIOptions.update;\r\n\r\n      /**\r\n       * @type {StoreUIOptions}\r\n       */\r\n      const storeUIOptions = {\r\n         subscribe: writableUIOptions.subscribe,\r\n\r\n         headerButtons: derived(writableUIOptions, ($options, set) => set($options.headerButtons)),\r\n         minimized: derived(writableUIOptions, ($options, set) => set($options.minimized))\r\n      };\r\n\r\n      Object.freeze(storeUIOptions);\r\n\r\n      // Initialize the store with options set in the Application constructor.\r\n      this.#storeUIOptions = storeUIOptions;\r\n   }\r\n\r\n   /**\r\n    * Registers local store subscriptions for app options. `popOut` controls registering this app with `ui.windows`.\r\n    * `zIndex` controls the z-index style of the element root.\r\n    *\r\n    * @see SvelteApplication._injectHTML\r\n    */\r\n   #storesSubscribe()\r\n   {\r\n      // Register local subscriptions.\r\n      this.#storeUnsubscribe.push(this.#storeAppOptions.popOut.subscribe((value) =>\r\n      {\r\n         if (value && this.rendered)\r\n         {\r\n            ui.windows[this.appId] = this;\r\n         }\r\n         else\r\n         {\r\n            delete ui.windows[this.appId];\r\n         }\r\n      }));\r\n\r\n      // Handles directly updating the element root `z-index` style when `zIndex` changes.\r\n      this.#storeUnsubscribe.push(this.#storeAppOptions.zIndex.subscribe((value) =>\r\n      {\r\n         if (this._element !== null) { this._element[0].style.zIndex = value; }\r\n      }));\r\n   }\r\n\r\n   /**\r\n    * Unsubscribes from any locally monitored stores.\r\n    *\r\n    * @see SvelteApplication.close\r\n    */\r\n   #storesUnsubscribe()\r\n   {\r\n      this.#storeUnsubscribe.forEach((unsubscribe) => unsubscribe());\r\n      this.#storeUnsubscribe = [];\r\n   }\r\n\r\n   /**\r\n    * Updates the UI Options store with the current header buttons. You may dynamically add / remove header buttons\r\n    * if using an application shell Svelte component. In either overriding `_getHeaderButtons` or responding to the\r\n    * Hooks fired return a new button array and the uiOptions store is updated and the application shell will render\r\n    * the new buttons.\r\n    *\r\n    * Optionally you can set in the Foundry app options `headerButtonNoLabel` to true and labels will be removed from\r\n    * the header buttons.\r\n    */\r\n   updateHeaderButtons()\r\n   {\r\n      const buttons = this._getHeaderButtons();\r\n\r\n      // Remove labels if this.options.headerButtonNoLabel is true;\r\n      if (typeof this.options.headerButtonNoLabel === 'boolean' && this.options.headerButtonNoLabel)\r\n      {\r\n         for (const button of buttons) { button.label = void 0; }\r\n      }\r\n\r\n      this.#storeUIOptionsUpdate((options) =>\r\n      {\r\n         options.headerButtons = buttons;\r\n         return options;\r\n      });\r\n   }\r\n}\r\n\r\n/**\r\n * Instantiates and attaches a Svelte component to the main inserted HTML.\r\n *\r\n * @param {SvelteApplication} app - The application\r\n *\r\n * @param {JQuery}            html - The inserted HTML.\r\n *\r\n * @param {object}            config - Svelte component options\r\n *\r\n * @param {StoreAppOptions}   storeAppOptions - Svelte store for app options.\r\n *\r\n * @param {StoreUIOptions}    storeUIOptions - Svelte store for UI options.\r\n *\r\n * @returns {object} The config + instantiated Svelte component.\r\n */\r\nfunction s_LOAD_CONFIG(app, html, config, storeAppOptions, storeUIOptions)\r\n{\r\n   const svelteOptions = typeof config.options === 'object' ? config.options : {};\r\n\r\n   // TODO EVALUATE; COMMENTED OUT WHILE WORKING ON HandlebarsApplication.\r\n   // if (typeof app.template === 'string' && typeof config.target !== 'string')\r\n   // {\r\n   //    throw new TypeError(\r\n   //     `SvelteApplication - s_LOAD_CONFIG - Template defined and target selector not a string for config:\\n${\r\n   //      JSON.stringify(config)}`);\r\n   // }\r\n\r\n   let target;\r\n\r\n   if (config.target instanceof HTMLElement)       // A specific HTMLElement to append Svelte component.\r\n   {\r\n      target = config.target;\r\n   }\r\n   else if (typeof config.target === 'string')     // A string target defines a selector to find in existing HTML.\r\n   {\r\n      target = html.find(config.target).get(0);\r\n   }\r\n   else                                            // No target defined, create a document fragment.\r\n   {\r\n      target = document.createDocumentFragment();\r\n   }\r\n\r\n   if (target === void 0)\r\n   {\r\n      throw new Error(\r\n       `SvelteApplication - s_LOAD_CONFIG - could not find target selector: ${config.target} for config:\\n${\r\n        JSON.stringify(config)}`);\r\n   }\r\n\r\n   const NewSvelteComponent = config.class;\r\n\r\n   const svelteConfig = parseSvelteConfig({ ...config, target }, app);\r\n\r\n   const externalContext = svelteConfig.context.get('external');\r\n\r\n   // Inject the Foundry application instance as a Svelte prop.\r\n   externalContext.foundryApp = app;\r\n\r\n   // Always inject the appOptions and uiOptions stores.\r\n   externalContext.storeAppOptions = storeAppOptions;\r\n   externalContext.storeUIOptions = storeUIOptions;\r\n\r\n   let eventbus;\r\n\r\n   // Potentially inject any TyphonJS eventbus and track the proxy in the SvelteData instance.\r\n   if (typeof app._eventbus === 'object' && typeof app._eventbus.createProxy === 'function')\r\n   {\r\n      eventbus = app._eventbus.createProxy();\r\n      externalContext.eventbus = eventbus;\r\n   }\r\n\r\n   // Create the Svelte component.\r\n   const component = new NewSvelteComponent(svelteConfig);\r\n\r\n   // Set any eventbus to the config.\r\n   svelteConfig.eventbus = eventbus;\r\n\r\n   let element;\r\n\r\n   // We can directly get the root element from components which follow the application store contract.\r\n   if (isApplicationShell(component))\r\n   {\r\n      element = component.elementRoot;\r\n   }\r\n\r\n   // Detect if target is a synthesized DocumentFragment with an child element. Child elements will be present\r\n   // if the Svelte component mounts and renders initial content into the document fragment.\r\n   if (config.target instanceof DocumentFragment && target.firstElementChild)\r\n   {\r\n      if (element === void 0) { element = target.firstElementChild; }\r\n      html.append(target);\r\n   }\r\n   else if (config.target instanceof HTMLElement && element === void 0)\r\n   {\r\n      if (config.target instanceof HTMLElement && typeof svelteOptions.selectorElement !== 'string')\r\n      {\r\n         throw new Error(\r\n          `SvelteApplication - s_LOAD_CONFIG - HTMLElement target with no 'selectorElement' defined for config:\\n${\r\n           JSON.stringify(config)}`);\r\n      }\r\n\r\n      // The target is an HTMLElement so find the Application element from `selectorElement` option.\r\n      element = target.querySelector(svelteOptions.selectorElement);\r\n\r\n      if (element === null || element === void 0)\r\n      {\r\n         throw new Error(\r\n          `SvelteApplication - s_LOAD_CONFIG - HTMLElement target - could not find 'selectorElement' for config:\\n${\r\n           JSON.stringify(config)}`);\r\n      }\r\n   }\r\n\r\n   // If the configuration / original target is an HTML element then do not inject HTML.\r\n   const injectHTML = !(config.target instanceof HTMLElement);\r\n\r\n   const result = { config: svelteConfig, component, element, injectHTML };\r\n\r\n   Object.freeze(result);\r\n\r\n   return result;\r\n}\r\n","import { DialogShell }           from '@typhonjs-fvtt/svelte/component/core';\r\nimport { safeAccess, safeSet }   from '@typhonjs-utils/object';\r\n\r\nimport { SvelteApplication }     from './SvelteApplication.js';\r\n\r\n/**\r\n * Provides a Foundry API compatible dialog alternative implemented w/ Svelte. There are several features including\r\n * a glasspane / modal option with various styling and transition capabilities.\r\n */\r\nexport class TJSDialog extends SvelteApplication\r\n{\r\n   #data;\r\n\r\n   constructor(data, options)\r\n   {\r\n      super(options);\r\n\r\n      this.#data = data;\r\n   }\r\n\r\n   static get defaultOptions()\r\n   {\r\n      return foundry.utils.mergeObject(super.defaultOptions, {\r\n         classes: ['dialog'],\r\n         width: 400,\r\n         svelte: {\r\n            class: DialogShell,\r\n            intro: true,\r\n            target: document.body,\r\n            props: function() { return { data: this.#data }; }\r\n         }\r\n      });\r\n   }\r\n\r\n   get content() { return this.getDialogData('content'); }\r\n\r\n   get data() { return this.#data; }\r\n\r\n   set content(content) { this.setDialogData('content', content); }\r\n\r\n   set data(data)\r\n   {\r\n      this.#data = data;\r\n\r\n      const component = this.svelte.applicationShell;\r\n      if (component?.data) { component.data = data; }\r\n   }\r\n\r\n   /**\r\n    * Implemented only for backwards compatibility w/ default Foundry {@link Dialog} API.\r\n    *\r\n    * @param {JQuery}   html - JQuery element for content area.\r\n    */\r\n   activateListeners(html)\r\n   {\r\n      super.activateListeners(html);\r\n\r\n      if (this.data.render instanceof Function) { this.data.render(this.options.jQuery ? html : html[0]); }\r\n   }\r\n\r\n   async close(options)\r\n   {\r\n      /**\r\n       * Implemented only for backwards compatibility w/ default Foundry {@link Dialog} API.\r\n       */\r\n       if (this.data.close instanceof Function)\r\n      {\r\n         this.data.close(this.options.jQuery ? this.element : this.element[0]);\r\n      }\r\n\r\n      return super.close(options);\r\n   }\r\n\r\n   getDialogData(accessor, defaultValue)\r\n   {\r\n      return safeAccess(this.#data, accessor, defaultValue);\r\n   }\r\n\r\n   mergeDialogData(data)\r\n   {\r\n      this.data = foundry.utils.mergeObject(this.#data, data, { inplace: false });\r\n   }\r\n\r\n   /**\r\n    * Provides a way to safely set this dialogs data given an accessor string which describes the\r\n    * entries to walk. To access deeper entries into the object format the accessor string with `.` between entries\r\n    * to walk.\r\n    *\r\n    * Automatically the dialog data will be updated in the associated DialogShell Svelte component.\r\n    *\r\n    * // TODO DOCUMENT the accessor in more detail.\r\n    *\r\n    * @param {string}   accessor - The path / key to set. You can set multiple levels.\r\n    *\r\n    * @param {*}        value - Value to set.\r\n    */\r\n   setDialogData(accessor, value)\r\n   {\r\n      const success = safeSet(this.#data, accessor, value);\r\n\r\n      // If `this.options` modified then update the app options store.\r\n      if (success)\r\n      {\r\n         const component = this.svelte.component(0);\r\n         if (component?.data) { component.data = this.#data; }\r\n      }\r\n   }\r\n\r\n   // ---------------------------------------------------------------------------------------------------------------\r\n\r\n   static async confirm({ title, content, yes, no, render, defaultYes = true, rejectClose = false, options = {},\r\n    buttons = {}, draggable = true, modal = false, modalOptions = {}, popOut = true, resizable = false, transition = {},\r\n     zIndex } = {})\r\n   {\r\n      // Allow overwriting of default icon and labels.\r\n      const mergedButtons = foundry.utils.mergeObject({\r\n         yes: {\r\n            icon: '<i class=\"fas fa-check\"></i>',\r\n            label: game.i18n.localize('Yes')\r\n         },\r\n         no: {\r\n            icon: '<i class=\"fas fa-times\"></i>',\r\n            label: game.i18n.localize('No'),\r\n         }\r\n      }, buttons);\r\n\r\n      return new Promise((resolve, reject) =>\r\n      {\r\n         const dialog = new this({\r\n            title,\r\n            content,\r\n            render,\r\n            draggable,\r\n            modal,\r\n            modalOptions,\r\n            popOut,\r\n            resizable,\r\n            zIndex,\r\n            transition,\r\n            buttons: foundry.utils.mergeObject(mergedButtons, {\r\n               yes: {\r\n                  callback: (html) =>\r\n                  {\r\n                     const result = yes ? yes(html) : true;\r\n                     resolve(result);\r\n                  }\r\n               },\r\n               no: {\r\n                  callback: (html) =>\r\n                  {\r\n                     const result = no ? no(html) : false;\r\n                     resolve(result);\r\n                  }\r\n               }\r\n            }),\r\n            default: defaultYes ? \"yes\" : \"no\",\r\n            close: () =>\r\n            {\r\n               if (rejectClose) { reject('The confirmation Dialog was closed without a choice being made.'); }\r\n               else { resolve(null); }\r\n            },\r\n         }, options);\r\n         dialog.render(true);\r\n      });\r\n   }\r\n\r\n   static async prompt({ title, content, label, callback, render, rejectClose = false, options = {}, draggable = true,\r\n    icon = '<i class=\"fas fa-check\"></i>', modal = false, modalOptions = {}, popOut = true, resizable = false,\r\n     transition = {}, zIndex } = {})\r\n   {\r\n      return new Promise((resolve, reject) =>\r\n      {\r\n         const dialog = new this({\r\n            title,\r\n            content,\r\n            render,\r\n            draggable,\r\n            modal,\r\n            modalOptions,\r\n            popOut,\r\n            resizable,\r\n            transition,\r\n            zIndex,\r\n            buttons: {\r\n               ok: {\r\n                  icon,\r\n                  label,\r\n                  callback: (html) =>\r\n                  {\r\n                     const result = callback ? callback(html) : null;\r\n                     resolve(result);\r\n                  }\r\n               },\r\n            },\r\n            default: 'ok',\r\n            close: () =>\r\n            {\r\n               if (rejectClose)\r\n               {\r\n                  reject(new Error('The Dialog prompt was closed without being accepted.'));\r\n               }\r\n               else { resolve(null); }\r\n            },\r\n         }, options);\r\n         dialog.render(true);\r\n      });\r\n   }\r\n}\r\n","import { TJSContextMenu }  from '@typhonjs-fvtt/svelte/component/core';\r\n\r\n/**\r\n * Provides game wide menu functionality.\r\n */\r\nexport class TJSMenu\r\n{\r\n   /**\r\n    * Stores any active context menu.\r\n    */\r\n   static #contextMenu = void 0;\r\n\r\n   /**\r\n    * Creates and manages a game wide context menu.\r\n    *\r\n    * @param {object}   opts - Optional parameters.\r\n    *\r\n    * @param {string}   [opts.id] - A custom CSS ID to add to the menu.\r\n    *\r\n    * @param {number}   opts.x - X position for the top / left of the menu.\r\n    *\r\n    * @param {number}   opts.y - Y position for the top / left of the menu.\r\n    *\r\n    * @param {object[]} opts.items - Menu items to display.\r\n    *\r\n    * @param {number}   [opts.zIndex=10000] - Z-index for context menu.\r\n    *\r\n    * @param {...*}     [opts.transitionOptions] - The rest of opts defined the slideFade transition options.\r\n    */\r\n   static createContext({id = '', x = 0, y = 0, items = [], zIndex = 10000, ...transitionOptions} = {})\r\n   {\r\n      if (this.#contextMenu !== void 0) { return; }\r\n\r\n      // Create the new context menu with the last click x / y point.\r\n      this.#contextMenu = new TJSContextMenu({\r\n         target: document.body,\r\n         intro: true,\r\n         props: { id, x, y, items, zIndex, transitionOptions }\r\n      });\r\n\r\n      // Register an event listener to remove any active context menu if closed from a menu selection or pointer\r\n      // down event to `document.body`.\r\n      this.#contextMenu.$on('close', () => { this.#contextMenu = void 0; });\r\n   }\r\n}\r\n"],"names":["safeAccess","data","accessor","defaultValue","access","split","cntr","length","safeSet","value","operation","createMissing","TypeError","Array","isArray","number","Number","isInteger","GetSvelteData","constructor","applicationShellHolder","svelteData","applicationShell","component","index","componentEntries","componentValues","dataEntries","entries","dataValues","values","Object","freeze","SvelteApplication","Application","options","defaultOptions","foundry","utils","mergeObject","draggable","headerButtonNoLabel","jqueryCloseAnimation","zIndex","elementContent","elementTarget","popOut","resizable","svelte","title","setOptions","content","HTMLElement","target","close","states","RENDER_STATES","force","RENDERED","ERROR","includes","_state","CLOSING","el","$","CLOSED","cls","_getInheritanceChain","Hooks","call","name","animate","style","minHeight","Promise","resolve","slideUp","svelteDestroyPromises","entry","push","outroAndDestroy","eventbus","config","off","all","remove","_element","ui","windows","appId","_minimized","_scrollPositions","storeOptions","minimized","getOptions","_injectHTML","html","Error","updateHeaderButtons","svelteConfig","s_LOAD_CONFIG","isApplicationShell","JSON","stringify","isDocumentFragment","DocumentFragment","injectHTML","elementRoot","hasGetter","element","selectorTarget","find","setTimeout","onSvelteMount","maximize","minimize","rendered","mergeOptions","instanceOptions","_replaceHTML","_renderInner","template","renderTemplate","document","createDocumentFragment","success","setPosition","left","top","width","height","scale","noHeight","noWidth","currentPosition","position","styles","globalThis","getComputedStyle","tarW","offsetWidth","minW","parseInt","minWidth","MIN_WINDOW_WIDTH","maxW","maxWidth","innerWidth","Math","clamped","tarH","offsetHeight","minH","MIN_WINDOW_HEIGHT","maxH","maxHeight","innerHeight","isFinite","tarL","maxL","max","tarT","maxT","transform","buttons","_getHeaderButtons","button","label","headerButtons","writtableAppOptions","writable","update","storeAppOptions","subscribe","derived","$options","set","minimizable","writableUIOptions","storeUIOptions","forEach","unsubscribe","app","svelteOptions","get","NewSvelteComponent","class","parseSvelteConfig","externalContext","context","foundryApp","_eventbus","createProxy","firstElementChild","append","selectorElement","querySelector","result","TJSDialog","classes","DialogShell","intro","body","props","getDialogData","setDialogData","activateListeners","render","Function","jQuery","mergeDialogData","inplace","confirm","yes","no","defaultYes","rejectClose","modal","modalOptions","transition","mergedButtons","icon","game","i18n","localize","reject","dialog","callback","default","prompt","ok","TJSMenu","createContext","id","x","y","items","transitionOptions","TJSContextMenu","$on"],"mappings":"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"}