{"version":3,"file":"typhonjs-oembed.js","sources":["../../../src/v5/Settings.js","../../../src/v5/core/sanitize.js","../../../src/v5/core/Nodes.js","../../../src/v5/core/updateHtml.js","../../../src/v5/ui/Buttons.js","../../../node_modules/@ephox/katamari/lib/main/ts/ephox/katamari/api/Optional.js","../../../node_modules/@ephox/katamari/lib/main/ts/ephox/katamari/api/Type.js","../../../node_modules/@ephox/katamari/lib/main/ts/ephox/katamari/api/Obj.js","../../../src/v5/core/htmlToData.js","../../../src/v5/core/Service.js","../../../src/v5/ui/Dialog.js","../../../src/v5/Plugin.js","../../../src/v5/core/ResolveName.js","../../../src/v5/core/FilterContent.js","../../../src/v5/core/Selection.js"],"sourcesContent":["/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nexport default class Settings\r\n{\r\n   static getDisableFilePoster(editor)\r\n   {\r\n      return editor.getParam('oembed_disable_file_poster', false);\r\n   }\r\n\r\n   static getDisableFileSource(editor)\r\n   {\r\n      return editor.getParam('oembed_disable_file_source', false);\r\n   }\r\n\r\n   static getMediaHeight(editor)\r\n   {\r\n      return editor.getParam('oembed_default_height', 288);\r\n   }\r\n\r\n   static getMediaWidth(editor)\r\n   {\r\n      return editor.getParam('oembed_default_width', 512);\r\n   }\r\n\r\n   static getUrlResolver(editor)\r\n   {\r\n      return editor.getParam('oembed_url_resolver');\r\n   }\r\n\r\n   static hasDimensions(editor)\r\n   {\r\n      return editor.getParam('oembed_dimensions', true);\r\n   }\r\n\r\n   static hasLiveEmbeds(editor)\r\n   {\r\n      return editor.getParam('oembed_live_embeds', true);\r\n   }\r\n\r\n   static hasPoster(editor)\r\n   {\r\n      return editor.getParam('oembed_poster', true);\r\n   }\r\n\r\n   static shouldFilterHtml(editor)\r\n   {\r\n      return editor.getParam('oembed_filter_html', true);\r\n   }\r\n}","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport Settings from '../Settings.js';\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {string}  html -\r\n *\r\n * @returns {string} -\r\n */\r\nexport const sanitize = (editor, html) =>\r\n{\r\n   if (Settings.shouldFilterHtml(editor) === false)\r\n   {\r\n      return html;\r\n   }\r\n\r\n   const writer = tinymce.html.Writer();\r\n   let blocked;\r\n\r\n   tinymce.html.SaxParser({\r\n      validate: false,\r\n      allow_conditional_comments: false,\r\n\r\n      comment: (text) =>\r\n      {\r\n         if (!blocked)\r\n         {\r\n            writer.comment(text);\r\n         }\r\n      },\r\n\r\n      cdata: (text) =>\r\n      {\r\n         if (!blocked)\r\n         {\r\n            writer.cdata(text);\r\n         }\r\n      },\r\n\r\n      text: (text, raw) =>\r\n      {\r\n         if (!blocked)\r\n         {\r\n            writer.text(text, raw);\r\n         }\r\n      },\r\n\r\n      start: (name, attrs, empty) =>\r\n      {\r\n         blocked = true;\r\n\r\n         if (name === 'script' || name === 'noscript' || name === 'svg')\r\n         {\r\n            return;\r\n         }\r\n\r\n         for (let i = attrs.length - 1; i >= 0; i--)\r\n         {\r\n            const attrName = attrs[i].name;\r\n\r\n            if (attrName.indexOf('on') === 0)\r\n            {\r\n               delete attrs.map[attrName];\r\n               attrs.splice(i, 1);\r\n            }\r\n\r\n            if (attrName === 'style')\r\n            {\r\n               attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\r\n            }\r\n         }\r\n\r\n         writer.start(name, attrs, empty);\r\n         blocked = false;\r\n      },\r\n\r\n      end: (name) =>\r\n      {\r\n         if (blocked)\r\n         {\r\n            return;\r\n         }\r\n\r\n         writer.end(name);\r\n      }\r\n   }, tinymce.html.Schema({})).parse(html);\r\n\r\n   return writer.getContent();\r\n};\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport Settings      from '../Settings.js';\r\nimport { sanitize }  from './sanitize.js';\r\n\r\n/**\r\n * Defines a transparent image.\r\n *\r\n * @type {string}\r\n */\r\nconst s_TRANSPARENT_SRC = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\r\n\r\n/**\r\n * Stores the poster image temporarily to potentially assign as a `data-oembed-poster`.\r\n *\r\n * @type {string}\r\n */\r\nlet s_OEMBED_POSTER;\r\n\r\n/**\r\n *\r\n */\r\nexport default class Nodes\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    *\r\n    * @returns {(function(import('tinymce').html.Node[]): void)} -\r\n    */\r\n   static placeHolderConverter(editor)\r\n   {\r\n      return (nodes) =>\r\n      {\r\n         let i = nodes.length;\r\n         let node;\r\n\r\n         while (i--)\r\n         {\r\n            node = nodes[i];\r\n\r\n            if (!node.parent || node.parent.attr('data-mce-object')) { continue; }\r\n\r\n            if (isLiveEmbedNode(node) && Settings.hasLiveEmbeds(editor))\r\n            {\r\n               if (!isWithinEmbedWrapper(node)) { node.replace(createPreviewNode(editor, node)); }\r\n            }\r\n            else\r\n            {\r\n               if (!isWithinEmbedWrapper(node)) { node.replace(createPlaceholderNode(editor, node)); }\r\n            }\r\n         }\r\n      };\r\n   }\r\n\r\n   /**\r\n    * @param {string}  poster -\r\n    */\r\n   static setPoster(poster)\r\n   {\r\n      s_OEMBED_POSTER = poster;\r\n   }\r\n}\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {string}  nodeName -\r\n *\r\n * @param {import('tinymce').html.Node} previewNode -\r\n *\r\n * @param {string}  html -\r\n */\r\nconst appendNodeContent = (editor, nodeName, previewNode, html) =>\r\n{\r\n   const newNode = tinymce.html.DomParser({ forced_root_block: false, validate: false },\r\n    editor.schema).parse(html, { context: nodeName });\r\n\r\n   while (newNode.firstChild) { previewNode.append(newNode.firstChild); }\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @returns {import('tinymce').html.Node} -\r\n */\r\nconst createPreviewNode = (editor, node) =>\r\n{\r\n   const name = node.name;\r\n\r\n   if (s_OEMBED_POSTER !== void 0) { node.attr('data-oembed-poster', s_OEMBED_POSTER); }\r\n\r\n   const previewWrapper = new tinymce.html.Node('span', 1);\r\n   previewWrapper.attr({\r\n      contentEditable: 'false',\r\n      style: node.attr('style'),\r\n      'data-mce-object': name,\r\n      class: `mce-preview-object mce-object-${name}`\r\n   });\r\n\r\n   retainAttributesAndInnerHtml(editor, node, previewWrapper);\r\n\r\n   const styles = editor.dom.parseStyle(node.attr('style'));\r\n   const previewNode = new tinymce.html.Node(name, 1);\r\n\r\n   setDimensions(node, previewNode, styles);\r\n\r\n   previewNode.attr({\r\n      src: node.attr('src'),\r\n      style: node.attr('style'),\r\n      class: node.attr('class')\r\n   });\r\n\r\n   if (name === 'iframe')\r\n   {\r\n      previewNode.attr({\r\n         allowfullscreen: node.attr('allowfullscreen'),\r\n         frameborder: '0'\r\n      });\r\n   }\r\n   else\r\n   {\r\n      // Exclude autoplay as we don't want video/audio to play by default\r\n      const attrs = ['controls', 'crossorigin', 'currentTime', 'loop', 'muted', 'poster', 'preload'];\r\n\r\n      for (const attrName of attrs) { previewNode.attr(attrName, node.attr(attrName)); }\r\n\r\n      // Recreate the child nodes using the sanitized inner HTML\r\n      const sanitizedHtml = previewWrapper.attr('data-mce-html');\r\n      if (sanitizedHtml !== null && sanitizedHtml !== void 0)\r\n      {\r\n         appendNodeContent(editor, name, previewNode, sanitizedHtml);\r\n      }\r\n   }\r\n\r\n   const shimNode = new tinymce.html.Node('span', 1);\r\n   shimNode.attr('class', 'mce-shim');\r\n\r\n   previewWrapper.append(previewNode);\r\n   previewWrapper.append(shimNode);\r\n\r\n   return previewWrapper;\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @returns {import('tinymce').html.Node} -\r\n */\r\nconst createPlaceholderNode = (editor, node) =>\r\n{\r\n   const name = node.name;\r\n\r\n   if (s_OEMBED_POSTER !== void 0) { node.attr('data-oembed-poster', s_OEMBED_POSTER); }\r\n\r\n   const placeHolder = new tinymce.html.Node('img', 1);\r\n   placeHolder.shortEnded = true;\r\n\r\n   retainAttributesAndInnerHtml(editor, node, placeHolder);\r\n\r\n   const poster = node.attr('data-oembed-poster');\r\n\r\n   setDimensions(node, placeHolder, {});\r\n   placeHolder.attr({\r\n      style: node.attr('style'),\r\n      src: poster ? poster : s_TRANSPARENT_SRC,\r\n      'data-mce-object': name,\r\n      class: `mce-object mce-object-${name}`\r\n   });\r\n\r\n   return placeHolder;\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @param {Record<string, string>} styles -\r\n *\r\n * @param {string} dimension -\r\n *\r\n * @param {string|null} defaultValue -\r\n *\r\n * @returns {string|null} -\r\n */\r\nconst getDimension = (node, styles, dimension, defaultValue = null) =>\r\n{\r\n   const value = node.attr(dimension);\r\n\r\n   if (value !== null && value !== void 0)\r\n   {\r\n      return value;\r\n   }\r\n   else if (!Object.hasOwnProperty.call(styles, dimension))\r\n   {\r\n      return defaultValue;\r\n   }\r\n   else\r\n   {\r\n      return null;\r\n   }\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @returns {boolean} -\r\n */\r\nconst isLiveEmbedNode = (node) =>\r\n{\r\n   const name = node.name;\r\n   return name === 'iframe' || name === 'video' || name === 'audio';\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @returns {boolean} -\r\n */\r\nconst isPageEmbedWrapper = (node) =>\r\n{\r\n   const nodeClass = node.attr('class');\r\n   return nodeClass && (/\\btiny-pageembed\\b/).test(nodeClass);\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @returns {boolean} -\r\n */\r\nconst isWithinEmbedWrapper = (node) =>\r\n{\r\n   while ((node = node.parent))\r\n   {\r\n      if (isPageEmbedWrapper(node)) { return true; }\r\n   }\r\n\r\n   return false;\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {import('tinymce').html.Node} sourceNode -\r\n *\r\n * @param {import('tinymce').html.Node} targetNode -\r\n */\r\nconst retainAttributesAndInnerHtml = (editor, sourceNode, targetNode) =>\r\n{\r\n   // Prefix all attributes except width, height and style since we will add these to the placeholder.\r\n   const attribs = sourceNode.attributes;\r\n   let ai = attribs.length;\r\n   while (ai--)\r\n   {\r\n      const attrName = attribs[ai].name;\r\n      let attrValue = attribs[ai].value;\r\n\r\n      if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style')\r\n      {\r\n         if (attrName === 'data' || attrName === 'src')\r\n         {\r\n            attrValue = editor.convertURL(attrValue, attrName);\r\n         }\r\n\r\n         targetNode.attr(`data-mce-p-${attrName}`, attrValue);\r\n      }\r\n   }\r\n\r\n   // Place the inner HTML contents inside an escaped attribute.\r\n   // This enables us to copy/paste the fake object.\r\n   const innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\r\n   if (innerHtml)\r\n   {\r\n      targetNode.attr('data-mce-html', escape(sanitize(editor, innerHtml)));\r\n      targetNode.firstChild = null;\r\n   }\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').html.Node} node -\r\n *\r\n * @param {import('tinymce').html.Node} previewNode -\r\n *\r\n * @param {Record<string, string>} styles -\r\n */\r\nconst setDimensions = (node, previewNode, styles) =>\r\n{\r\n   // Apply dimensions for video elements to maintain legacy behaviour.\r\n   const useDefaults = previewNode.name === 'img' || node.name === 'video';\r\n\r\n   // Determine the defaults.\r\n   const defaultWidth = useDefaults ? '300' : null;\r\n   const fallbackHeight = node.name === 'audio' ? '30' : '150';\r\n   const defaultHeight = useDefaults ? fallbackHeight : null;\r\n\r\n   previewNode.attr({\r\n      width: getDimension(node, styles, 'width', defaultWidth),\r\n      height: getDimension(node, styles, 'height', defaultHeight)\r\n   });\r\n};\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\n\r\n/**\r\n * @param {AttrList}            attrs -\r\n *\r\n * @param {Record<string, any>} updatedAttrs -\r\n */\r\nconst setAttributes = (attrs, updatedAttrs) =>\r\n{\r\n   const props = Object.keys(updatedAttrs);\r\n   for (let k = 0, len = props.length; k < len; k++)\r\n   {\r\n      const name = props[k];\r\n      const val = updatedAttrs[name];\r\n\r\n      const value = `${val}`;\r\n\r\n      if (attrs.map[name])\r\n      {\r\n         let i = attrs.length;\r\n         while (i--)\r\n         {\r\n            const attr = attrs[i];\r\n\r\n            if (attr.name === name)\r\n            {\r\n               if (value)\r\n               {\r\n                  attrs.map[name] = value;\r\n                  attr.value = value;\r\n               }\r\n               else\r\n               {\r\n                  delete attrs.map[name];\r\n                  attrs.splice(i, 1);\r\n               }\r\n            }\r\n         }\r\n      }\r\n      else if (value)\r\n      {\r\n         attrs.push({\r\n            name,\r\n            value\r\n         });\r\n\r\n         attrs.map[name] = value;\r\n      }\r\n   }\r\n};\r\n\r\nconst sources = ['source'];\r\n\r\n/**\r\n * @param {string}              html -\r\n *\r\n * @param {Partial<MediaData>}  data -\r\n *\r\n * @param {boolean}             [updateAll] -\r\n *\r\n * @returns {string} -\r\n */\r\nexport const updateHtml = (html, data, updateAll) =>\r\n{\r\n   const writer = tinymce.html.Writer();\r\n   let sourceCount = 0;\r\n   let hasImage;\r\n\r\n   tinymce.html.SaxParser({\r\n      validate: false,\r\n      allow_conditional_comments: true,\r\n\r\n      comment: (text) =>\r\n      {\r\n         writer.comment(text);\r\n      },\r\n\r\n      cdata: (text) =>\r\n      {\r\n         writer.cdata(text);\r\n      },\r\n\r\n      text: (text, raw) =>\r\n      {\r\n         writer.text(text, raw);\r\n      },\r\n\r\n      start: (name, attrs, empty) =>\r\n      {\r\n         switch (name)\r\n         {\r\n            case 'video':\r\n            case 'object':\r\n            case 'embed':\r\n            case 'img':\r\n            case 'iframe':\r\n               if (data.height !== undefined && data.width !== undefined)\r\n               {\r\n                  setAttributes(attrs, {\r\n                     width: data.width,\r\n                     height: data.height\r\n                  });\r\n               }\r\n               break;\r\n         }\r\n\r\n         if (updateAll)\r\n         {\r\n            switch (name)\r\n            {\r\n               case 'video':\r\n                  setAttributes(attrs, {\r\n                     poster: data.poster,\r\n                     src: ''\r\n                  });\r\n                  break;\r\n\r\n               case 'iframe':\r\n                  setAttributes(attrs, {\r\n                     src: data.source\r\n                  });\r\n                  break;\r\n\r\n               case 'source':\r\n                  if (sourceCount < 2)\r\n                  {\r\n                     setAttributes(attrs, {\r\n                        src: data[sources[sourceCount]],\r\n                        type: data[`${sources[sourceCount]}mime`]\r\n                     });\r\n\r\n                     if (!data[sources[sourceCount]])\r\n                     {\r\n                        return;\r\n                     }\r\n                  }\r\n                  sourceCount++;\r\n                  break;\r\n\r\n               case 'img':\r\n                  if (!data.poster)\r\n                  {\r\n                     return;\r\n                  }\r\n\r\n                  hasImage = true;\r\n                  break;\r\n            }\r\n         }\r\n\r\n         writer.start(name, attrs, empty);\r\n      },\r\n\r\n      end: (name) =>\r\n      {\r\n         if (name === 'video' && updateAll)\r\n         {\r\n            for (let index = 0; index < 2; index++)\r\n            {\r\n               if (data[sources[index]])\r\n               {\r\n\r\n                  /**\r\n                   * An attribute list.\r\n                   *\r\n                   * @type {any}\r\n                   */\r\n                  const attrs = [];\r\n                  attrs.map = {};\r\n\r\n                  if (sourceCount <= index)\r\n                  {\r\n                     setAttributes(attrs, {\r\n                        src: data[sources[index]],\r\n                        type: data[`${sources[index]}mime`]\r\n                     });\r\n\r\n                     writer.start('source', attrs, true);\r\n                  }\r\n               }\r\n            }\r\n         }\r\n\r\n         if (data.poster && name === 'object' && updateAll && !hasImage)\r\n         {\r\n\r\n            /**\r\n             * An attribute list.\r\n             *\r\n             * @type {any}\r\n             */\r\n            const imgAttrs = [];\r\n            imgAttrs.map = {};\r\n\r\n            setAttributes(imgAttrs, {\r\n               src: data.poster,\r\n               width: data.width,\r\n               height: data.height\r\n            });\r\n\r\n            writer.start('img', imgAttrs, true);\r\n         }\r\n\r\n         writer.end(name);\r\n      }\r\n   }, tinymce.html.Schema({})).parse(html);\r\n\r\n   return writer.getContent();\r\n};\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\n\r\n/**\r\n *\r\n */\r\nexport default class Buttons\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    */\r\n   static register(editor)\r\n   {\r\n      editor.ui.registry.addToggleButton('typhonjs-oembed', {\r\n         tooltip: 'Insert/edit media',\r\n         icon: 'embed',\r\n         onAction: () =>\r\n         {\r\n            editor.execCommand('typhonjsOembed');\r\n         },\r\n         onSetup: stateSelectorAdapter(editor, ['img[data-mce-object]', 'span[data-mce-object]'])\r\n      });\r\n\r\n      editor.ui.registry.addMenuItem('typhonjs-oembed', {\r\n         icon: 'embed',\r\n         text: 'Media...',\r\n         onAction: () =>\r\n         {\r\n            editor.execCommand('typhonjsOembed');\r\n         }\r\n      });\r\n   }\r\n}\r\n\r\n/**\r\n * @param {import('tinymce').Editor}    editor -\r\n *\r\n * @param {string[]}  selector -\r\n *\r\n * @returns {function(import('tinymce').Toolbar.ToolbarToggleButtonInstanceApi): *} -\r\n */\r\nconst stateSelectorAdapter = (editor, selector) => (buttonApi) =>\r\n editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\r\n","import * as Type from './Type';\n/**\n * The `Optional` type represents a value (of any type) that potentially does\n * not exist. Any `Optional<T>` can either be a `Some<T>` (in which case the\n * value does exist) or a `None` (in which case the value does not exist). This\n * module defines a whole lot of FP-inspired utility functions for dealing with\n * `Optional` objects.\n *\n * Comparison with null or undefined:\n * - We don't get fancy null coalescing operators with `Optional`\n * - We do get fancy helper functions with `Optional`\n * - `Optional` support nesting, and allow for the type to still be nullable (or\n * another `Optional`)\n * - There is no option to turn off strict-optional-checks like there is for\n * strict-null-checks\n */\nexport class Optional {\n    // The internal representation has a `tag` and a `value`, but both are\n    // private: able to be console.logged, but not able to be accessed by code\n    constructor(tag, value) {\n        this.tag = tag;\n        this.value = value;\n    }\n    // --- Identities ---\n    /**\n     * Creates a new `Optional<T>` that **does** contain a value.\n     */\n    static some(value) {\n        return new Optional(true, value);\n    }\n    /**\n     * Create a new `Optional<T>` that **does not** contain a value. `T` can be\n     * any type because we don't actually have a `T`.\n     */\n    static none() {\n        return Optional.singletonNone;\n    }\n    /**\n     * Perform a transform on an `Optional` type. Regardless of whether this\n     * `Optional` contains a value or not, `fold` will return a value of type `U`.\n     * If this `Optional` does not contain a value, the `U` will be created by\n     * calling `onNone`. If this `Optional` does contain a value, the `U` will be\n     * created by calling `onSome`.\n     *\n     * For the FP enthusiasts in the room, this function:\n     * 1. Could be used to implement all of the functions below\n     * 2. Forms a catamorphism\n     */\n    fold(onNone, onSome) {\n        if (this.tag) {\n            return onSome(this.value);\n        }\n        else {\n            return onNone();\n        }\n    }\n    /**\n     * Determine if this `Optional` object contains a value.\n     */\n    isSome() {\n        return this.tag;\n    }\n    /**\n     * Determine if this `Optional` object **does not** contain a value.\n     */\n    isNone() {\n        return !this.tag;\n    }\n    // --- Functor (name stolen from Haskell / maths) ---\n    /**\n     * Perform a transform on an `Optional` object, **if** there is a value. If\n     * you provide a function to turn a T into a U, this is the function you use\n     * to turn an `Optional<T>` into an `Optional<U>`. If this **does** contain\n     * a value then the output will also contain a value (that value being the\n     * output of `mapper(this.value)`), and if this **does not** contain a value\n     * then neither will the output.\n     */\n    map(mapper) {\n        if (this.tag) {\n            return Optional.some(mapper(this.value));\n        }\n        else {\n            return Optional.none();\n        }\n    }\n    // --- Monad (name stolen from Haskell / maths) ---\n    /**\n     * Perform a transform on an `Optional` object, **if** there is a value.\n     * Unlike `map`, here the transform itself also returns an `Optional`.\n     */\n    bind(binder) {\n        if (this.tag) {\n            return binder(this.value);\n        }\n        else {\n            return Optional.none();\n        }\n    }\n    // --- Traversable (name stolen from Haskell / maths) ---\n    /**\n     * For a given predicate, this function finds out if there **exists** a value\n     * inside this `Optional` object that meets the predicate. In practice, this\n     * means that for `Optional`s that do not contain a value it returns false (as\n     * no predicate-meeting value exists).\n     */\n    exists(predicate) {\n        return this.tag && predicate(this.value);\n    }\n    /**\n     * For a given predicate, this function finds out if **all** the values inside\n     * this `Optional` object meet the predicate. In practice, this means that\n     * for `Optional`s that do not contain a value it returns true (as all 0\n     * objects do meet the predicate).\n     */\n    forall(predicate) {\n        return !this.tag || predicate(this.value);\n    }\n    filter(predicate) {\n        if (!this.tag || predicate(this.value)) {\n            return this;\n        }\n        else {\n            return Optional.none();\n        }\n    }\n    // --- Getters ---\n    /**\n     * Get the value out of the inside of the `Optional` object, using a default\n     * `replacement` value if the provided `Optional` object does not contain a\n     * value.\n     */\n    getOr(replacement) {\n        return this.tag ? this.value : replacement;\n    }\n    /**\n     * Get the value out of the inside of the `Optional` object, using a default\n     * `replacement` value if the provided `Optional` object does not contain a\n     * value.  Unlike `getOr`, in this method the `replacement` object is also\n     * `Optional` - meaning that this method will always return an `Optional`.\n     */\n    or(replacement) {\n        return this.tag ? this : replacement;\n    }\n    /**\n     * Get the value out of the inside of the `Optional` object, using a default\n     * `replacement` value if the provided `Optional` object does not contain a\n     * value. Unlike `getOr`, in this method the `replacement` value is\n     * \"thunked\" - that is to say that you don't pass a value to `getOrThunk`, you\n     * pass a function which (if called) will **return** the `value` you want to\n     * use.\n     */\n    getOrThunk(thunk) {\n        return this.tag ? this.value : thunk();\n    }\n    /**\n     * Get the value out of the inside of the `Optional` object, using a default\n     * `replacement` value if the provided Optional object does not contain a\n     * value.\n     *\n     * Unlike `or`, in this method the `replacement` value is \"thunked\" - that is\n     * to say that you don't pass a value to `orThunk`, you pass a function which\n     * (if called) will **return** the `value` you want to use.\n     *\n     * Unlike `getOrThunk`, in this method the `replacement` value is also\n     * `Optional`, meaning that this method will always return an `Optional`.\n     */\n    orThunk(thunk) {\n        return this.tag ? this : thunk();\n    }\n    /**\n     * Get the value out of the inside of the `Optional` object, throwing an\n     * exception if the provided `Optional` object does not contain a value.\n     *\n     * WARNING:\n     * You should only be using this function if you know that the `Optional`\n     * object **is not** empty (otherwise you're throwing exceptions in production\n     * code, which is bad).\n     *\n     * In tests this is more acceptable.\n     *\n     * Prefer other methods to this, such as `.each`.\n     */\n    getOrDie(message) {\n        if (!this.tag) {\n            throw new Error(message !== null && message !== void 0 ? message : 'Called getOrDie on None');\n        }\n        else {\n            return this.value;\n        }\n    }\n    // --- Interop with null and undefined ---\n    /**\n     * Creates an `Optional` value from a nullable (or undefined-able) input.\n     * Null, or undefined, is converted to `None`, and anything else is converted\n     * to `Some`.\n     */\n    static from(value) {\n        return Type.isNonNullable(value) ? Optional.some(value) : Optional.none();\n    }\n    /**\n     * Converts an `Optional` to a nullable type, by getting the value if it\n     * exists, or returning `null` if it does not.\n     */\n    getOrNull() {\n        return this.tag ? this.value : null;\n    }\n    /**\n     * Converts an `Optional` to an undefined-able type, by getting the value if\n     * it exists, or returning `undefined` if it does not.\n     */\n    getOrUndefined() {\n        return this.value;\n    }\n    // --- Utilities ---\n    /**\n     * If the `Optional` contains a value, perform an action on that value.\n     * Unlike the rest of the methods on this type, `.each` has side-effects. If\n     * you want to transform an `Optional<T>` **into** something, then this is not\n     * the method for you. If you want to use an `Optional<T>` to **do**\n     * something, then this is the method for you - provided you're okay with not\n     * doing anything in the case where the `Optional` doesn't have a value inside\n     * it. If you're not sure whether your use-case fits into transforming\n     * **into** something or **doing** something, check whether it has a return\n     * value. If it does, you should be performing a transform.\n     */\n    each(worker) {\n        if (this.tag) {\n            worker(this.value);\n        }\n    }\n    /**\n     * Turn the `Optional` object into an array that contains all of the values\n     * stored inside the `Optional`. In practice, this means the output will have\n     * either 0 or 1 elements.\n     */\n    toArray() {\n        return this.tag ? [this.value] : [];\n    }\n    /**\n     * Turn the `Optional` object into a string for debugging or printing. Not\n     * recommended for production code, but good for debugging. Also note that\n     * these days an `Optional` object can be logged to the console directly, and\n     * its inner value (if it exists) will be visible.\n     */\n    toString() {\n        return this.tag ? `some(${this.value})` : 'none()';\n    }\n}\n// Sneaky optimisation: every instance of Optional.none is identical, so just\n// reuse the same object\nOptional.singletonNone = new Optional(false);\n//# sourceMappingURL=Optional.js.map","const getPrototypeOf = Object.getPrototypeOf;\nconst hasProto = (v, constructor, predicate) => {\n    var _a;\n    if (predicate(v, constructor.prototype)) {\n        return true;\n    }\n    else {\n        // String-based fallback time\n        return ((_a = v.constructor) === null || _a === void 0 ? void 0 : _a.name) === constructor.name;\n    }\n};\nconst typeOf = (x) => {\n    const t = typeof x;\n    if (x === null) {\n        return 'null';\n    }\n    else if (t === 'object' && Array.isArray(x)) {\n        return 'array';\n    }\n    else if (t === 'object' && hasProto(x, String, (o, proto) => proto.isPrototypeOf(o))) {\n        return 'string';\n    }\n    else {\n        return t;\n    }\n};\nconst isType = (type) => (value) => typeOf(value) === type;\nconst isSimpleType = (type) => (value) => typeof value === type;\nconst eq = (t) => (a) => t === a;\nexport const is = (value, constructor) => isObject(value) && hasProto(value, constructor, (o, proto) => getPrototypeOf(o) === proto);\nexport const isString = isType('string');\nexport const isObject = isType('object');\nexport const isPlainObject = (value) => is(value, Object);\nexport const isArray = isType('array');\nexport const isNull = eq(null);\nexport const isBoolean = isSimpleType('boolean');\nexport const isUndefined = eq(undefined);\nexport const isNullable = (a) => a === null || a === undefined;\nexport const isNonNullable = (a) => !isNullable(a);\nexport const isFunction = isSimpleType('function');\nexport const isNumber = isSimpleType('number');\nexport const isArrayOf = (value, pred) => {\n    if (isArray(value)) {\n        for (let i = 0, len = value.length; i < len; ++i) {\n            if (!(pred(value[i]))) {\n                return false;\n            }\n        }\n        return true;\n    }\n    return false;\n};\n//# sourceMappingURL=Type.js.map","import { Eq } from '@ephox/dispute';\nimport * as Fun from './Fun';\nimport { Optional } from './Optional';\n// There are many variations of Object iteration that are faster than the 'for-in' style:\n// http://jsperf.com/object-keys-iteration/107\n//\n// Use the native keys if it is available (IE9+), otherwise fall back to manually filtering\nexport const keys = Object.keys;\n// eslint-disable-next-line @typescript-eslint/unbound-method\nexport const hasOwnProperty = Object.hasOwnProperty;\nexport const each = (obj, f) => {\n    const props = keys(obj);\n    for (let k = 0, len = props.length; k < len; k++) {\n        const i = props[k];\n        const x = obj[i];\n        f(x, i);\n    }\n};\nexport const map = (obj, f) => {\n    return tupleMap(obj, (x, i) => ({\n        k: i,\n        v: f(x, i)\n    }));\n};\nexport const tupleMap = (obj, f) => {\n    const r = {};\n    each(obj, (x, i) => {\n        const tuple = f(x, i);\n        r[tuple.k] = tuple.v;\n    });\n    return r;\n};\nconst objAcc = (r) => (x, i) => {\n    r[i] = x;\n};\nconst internalFilter = (obj, pred, onTrue, onFalse) => {\n    each(obj, (x, i) => {\n        (pred(x, i) ? onTrue : onFalse)(x, i);\n    });\n};\nexport const bifilter = (obj, pred) => {\n    const t = {};\n    const f = {};\n    internalFilter(obj, pred, objAcc(t), objAcc(f));\n    return { t, f };\n};\nexport const filter = (obj, pred) => {\n    const t = {};\n    internalFilter(obj, pred, objAcc(t), Fun.noop);\n    return t;\n};\nexport const mapToArray = (obj, f) => {\n    const r = [];\n    each(obj, (value, name) => {\n        r.push(f(value, name));\n    });\n    return r;\n};\nexport const find = (obj, pred) => {\n    const props = keys(obj);\n    for (let k = 0, len = props.length; k < len; k++) {\n        const i = props[k];\n        const x = obj[i];\n        if (pred(x, i, obj)) {\n            return Optional.some(x);\n        }\n    }\n    return Optional.none();\n};\nexport const values = (obj) => {\n    return mapToArray(obj, Fun.identity);\n};\nexport const size = (obj) => {\n    return keys(obj).length;\n};\nexport const get = (obj, key) => {\n    return has(obj, key) ? Optional.from(obj[key]) : Optional.none();\n};\nexport const has = (obj, key) => hasOwnProperty.call(obj, key);\nexport const hasNonNullableKey = (obj, key) => has(obj, key) && obj[key] !== undefined && obj[key] !== null;\nexport const isEmpty = (r) => {\n    for (const x in r) {\n        if (hasOwnProperty.call(r, x)) {\n            return false;\n        }\n    }\n    return true;\n};\nexport const equal = (a1, a2, eq = Eq.eqAny) => Eq.eqRecord(eq).eq(a1, a2);\n//# sourceMappingURL=Obj.js.map","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\n\r\n/**\r\n * @param {string}   html -\r\n *\r\n * @returns {MediaData} -\r\n */\r\nexport const htmlToData = (html) =>\r\n{\r\n   let data = {};\r\n\r\n   tinymce.html.SaxParser({\r\n      validate: false,\r\n      allow_conditional_comments: true,\r\n      start: (name, attrs) =>\r\n      {\r\n         if (!data.source && name === 'param')\r\n         {\r\n            data.source = attrs.map.movie;\r\n         }\r\n\r\n         if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio')\r\n         {\r\n            if (!data.type)\r\n            {\r\n               data.type = name;\r\n            }\r\n\r\n            data = Object.assign({}, attrs.map, data);\r\n         }\r\n\r\n         if (name === 'source')\r\n         {\r\n            if (!data.source)\r\n            {\r\n               data.source = attrs.map.src;\r\n            }\r\n         }\r\n\r\n         if (name === 'img' && !data.poster)\r\n         {\r\n            data.poster = attrs.map.src;\r\n         }\r\n\r\n         if (attrs.map['data-oembed-poster'] !== void 0)\r\n         {\r\n            data.poster = attrs.map['data-oembed-poster'];\r\n         }\r\n      }\r\n   }).parse(html);\r\n\r\n   data.source = data.source || data.src || data.data;\r\n   data.poster = data.poster || '';\r\n\r\n   return data;\r\n};","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport Settings from '../Settings.js';\r\n\r\n/**\r\n * @type {Map<string, EmbedData>}\r\n */\r\nconst s_CACHE = new Map();\r\n\r\n/**\r\n * Currently supports Vimeo / YouTube.\r\n *\r\n * @type {OEmbedService[]}\r\n */\r\nconst s_SERVICES = [\r\n   {\r\n      name: 'Vimeo',\r\n      regex: /^(https:\\/\\/vimeo.com\\/(.*)|https:\\/\\/vimeo.com\\/album\\/(.*)\\/video\\/(.*)|https:\\/\\/vimeo.com\\/channels\\/(.*)\\/(.*)|https:\\/\\/vimeo.com\\/groups\\/(.*)\\/videos\\/(.*)|https:\\/\\/vimeo.com\\/ondemand\\/(.*)\\/(.*)|https:\\/\\/player.vimeo.com\\/video\\/(.*))/,\r\n      url: (url, maxwidth, maxheight) => `https://vimeo.com/api/oembed.json?url=${url}&maxwidth=${maxwidth}&maxheight=${maxheight}`\r\n   },\r\n   {\r\n      name: 'YouTube',\r\n      regex: /^(https:\\/\\/(.*).youtube.com\\/watch(.*)|https:\\/\\/(.*).youtube.com\\/v\\/(.*)|https:\\/\\/youtu.be\\/(.*)|https:\\/\\/(.*).youtube.com\\/playlist?list=(.*))/,\r\n      url: (url, maxwidth, maxheight) => `https://www.youtube.com/oembed?url=${url}&format=json&maxwidth=${maxwidth}&maxheight=${maxheight}`\r\n   }\r\n];\r\n\r\n/**\r\n *\r\n */\r\nexport default class Service\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}    editor -\r\n    *\r\n    * @param {MediaData} data -\r\n    *\r\n    * @returns {Promise<EmbedData>} -\r\n    */\r\n   static async getEmbedHtml(editor, data)\r\n   {\r\n      let response;\r\n\r\n      if (s_CACHE.has(data.source))\r\n      {\r\n         return s_CACHE.get(data.source);\r\n      }\r\n\r\n      const embedHandler = Settings.getUrlResolver(editor);\r\n\r\n      if (embedHandler)\r\n      {\r\n         try\r\n         {\r\n            const handlerResponse = await embedHandler({ url: data.source });\r\n            response = { url: data.source, html: handlerResponse.html, poster: handlerResponse.poster };\r\n         }\r\n         catch (err)\r\n         {\r\n            const message = err.msg || err.message || 'Unknown error.';\r\n            editor.notificationManager.open({ type: 'error', text: `Media embed error: ${message}` });\r\n\r\n            return void 0;\r\n         }\r\n      }\r\n      else\r\n      {\r\n         let oembedName;\r\n         let oembedUrl;\r\n\r\n         const maxwidth = Settings.getMediaWidth(editor);\r\n         const maxheight = Settings.getMediaHeight(editor);\r\n\r\n         for (const service of s_SERVICES)\r\n         {\r\n            if (service.regex.exec(data.source))\r\n            {\r\n               oembedUrl = service.url(data.source, maxwidth, maxheight);\r\n               oembedName = service.name;\r\n            }\r\n         }\r\n\r\n         if (oembedUrl === void 0)\r\n         {\r\n            editor.notificationManager.open({\r\n               type: 'error',\r\n               text: 'Media embed error: URL did not match any providers available.'\r\n            });\r\n            return void 0;\r\n         }\r\n\r\n         // Fetch the embed URL from YouTube.\r\n         const remoteResponse = await window.fetch(oembedUrl);\r\n\r\n         if (!remoteResponse || remoteResponse.status !== 200)\r\n         {\r\n            editor.notificationManager.open({\r\n               type: 'error',\r\n               text: `Media embed error: Could not fetch ${oembedName} embed URL.`\r\n            });\r\n            return void 0;\r\n         }\r\n\r\n         const json = await remoteResponse.json();\r\n\r\n         if (json.html === void 0)\r\n         {\r\n            const message = json.error ? json.error : `Could not fetch ${oembedName} embed URL.`;\r\n\r\n            editor.notificationManager.open({\r\n               type: 'error',\r\n               text: `Media embed error: ${message}`\r\n            });\r\n            return void 0;\r\n         }\r\n\r\n         response = { url: data.source, html: json.html, poster: json.thumbnail_url };\r\n      }\r\n\r\n      s_CACHE.set(data.source, response);\r\n\r\n      return response;\r\n   }\r\n\r\n   /**\r\n    * @param {string} url -\r\n    *\r\n    * @returns {boolean} URL is cached.\r\n    */\r\n   static isCached(url)\r\n   {\r\n      return s_CACHE.has(url);\r\n   }\r\n}\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport { Obj, Optional }   from '@ephox/katamari';\r\n\r\nimport { htmlToData }      from '../core/htmlToData.js';\r\nimport Nodes               from '../core/Nodes.js';\r\nimport Service             from '../core/Service.js';\r\nimport { updateHtml }      from '../core/updateHtml.js';\r\nimport Settings            from '../Settings.js';\r\n\r\n/**\r\n *\r\n */\r\nexport default class Dialog\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    */\r\n   static showDialog(editor)\r\n   {\r\n      const editorData = getEditorData(editor);\r\n\r\n      let currentData = editorData;\r\n      const initialData = wrap(editorData);\r\n\r\n      const disableFilePoster = Settings.getDisableFilePoster(editor);\r\n      const disableFileSource = Settings.getDisableFileSource(editor);\r\n\r\n      const items = [];\r\n\r\n      // mediaInput - Dialog.UrlInputSpec\r\n      items.push({\r\n         name: 'source',\r\n         type: 'urlinput',\r\n         filetype: !disableFileSource ? 'media' : void 0,\r\n         label: 'Source'\r\n      });\r\n\r\n      // sizeInput - Dialog.SizeInputSpec\r\n      if (Settings.hasDimensions(editor))\r\n      {\r\n         items.push({\r\n            type: 'sizeinput',\r\n            name: 'dimensions',\r\n            label: 'Constrain proportions',\r\n            constrain: true\r\n         });\r\n      }\r\n\r\n      // mediaPoster - Dialog.UrlInputSpec\r\n      items.push({\r\n         name: 'poster',\r\n         type: 'urlinput',\r\n         filetype: !disableFilePoster ? 'image' : void 0,\r\n         label: 'Media poster (Image URL)'\r\n      });\r\n\r\n      // embedTextarea - Dialog.TextAreaSpec\r\n      items.push({\r\n         name: 'embed',\r\n         type: 'textarea',\r\n         label: 'Generated Embed:',\r\n         disabled: true\r\n      });\r\n\r\n      /**\r\n       * @type {import('tinymce').Dialog.PanelSpec}\r\n       */\r\n      const body = {\r\n         type: 'panel',\r\n         items\r\n      };\r\n\r\n      editor.windowManager.open({\r\n         title: 'Insert/Edit Media (oEmbed)',\r\n         size: 'normal',\r\n\r\n         body,\r\n         buttons: [\r\n            {\r\n               type: 'cancel',\r\n               name: 'cancel',\r\n               text: 'Cancel'\r\n            },\r\n            {\r\n               type: 'submit',\r\n               name: 'save',\r\n               text: 'Save',\r\n               primary: true\r\n            }\r\n         ],\r\n         onSubmit: async (api) =>\r\n         {\r\n            const serviceData = Dialog.unwrap(api.getData());\r\n            await submitForm(currentData, serviceData, editor);\r\n            api.close();\r\n         },\r\n         onChange: async (api, detail) =>\r\n         {\r\n            try\r\n            {\r\n               switch (detail.name)\r\n               {\r\n                  case 'source':\r\n                     await handleSource(currentData, api, editor);\r\n                     break;\r\n\r\n                  case 'embed':\r\n                     handleEmbed(api, editor);\r\n                     break;\r\n\r\n                  case 'dimensions':\r\n                  case 'poster':\r\n                     handleUpdate(api, detail.name);\r\n                     break;\r\n\r\n                  default:\r\n                     break;\r\n               }\r\n               currentData = Dialog.unwrap(api.getData());\r\n            }\r\n            catch (err)\r\n            {\r\n               console.log(err);\r\n            }\r\n         },\r\n         initialData\r\n      }, void 0);\r\n   }\r\n\r\n   /**\r\n    * @param {MediaDialogData}       data -\r\n    *\r\n    * @param {keyof MediaDialogData} [sourceInput] -\r\n    *\r\n    * @returns {MediaData} -\r\n    */\r\n   static unwrap(data, sourceInput)\r\n   {\r\n      const metaData = sourceInput ? extractMeta(sourceInput, data).getOr({}) : {};\r\n      const get = getValue(data, metaData, sourceInput);\r\n      return {\r\n         ...get('source'),\r\n         ...get('poster'),\r\n         ...get('embed'),\r\n         ...getDimensions(data, metaData)\r\n      };\r\n   }\r\n}\r\n\r\n/**\r\n * @type {('width' | 'height')[]}\r\n */\r\nconst s_DIMENSION_ATTR = ['width', 'height'];\r\n\r\n/**\r\n * @param {{ url: string; html: string; poster: string }} response -\r\n *\r\n * @param {import('tinymce').Dialog.DialogInstanceApi<MediaDialogData>}     api -\r\n *\r\n * @param {Editor}  editor -\r\n */\r\nconst addEmbedHtml = (response, api, editor) =>\r\n{\r\n   // Only set values if a URL has been defined\r\n   if (typeof response.url === 'string' && response.url.trim().length > 0)\r\n   {\r\n      const html = response.html;\r\n      const snippetData = snippetToData(editor, html);\r\n\r\n      /**\r\n       * @type {MediaData}\r\n       */\r\n      const nuData = {\r\n         ...snippetData,\r\n         source: response.url,\r\n         embed: html,\r\n         poster: response.poster\r\n      };\r\n\r\n      api.setData(wrap(nuData));\r\n   }\r\n};\r\n\r\n/**\r\n * Note: mainData is DialogSubData\r\n *\r\n * @param {keyof MediaDialogData} sourceInput -\r\n *\r\n * @param {MediaDialogData}       data -\r\n *\r\n * @returns {Optional<Record<string, string>>} -\r\n */\r\nconst extractMeta = (sourceInput, data) => Obj.get(data, sourceInput).bind((mainData) => Obj.get(mainData, 'meta'));\r\n\r\n/**\r\n * @param {MediaDialogData}         data -\r\n *\r\n * @param {Record<string, string>}  metaData -\r\n *\r\n * @returns {{}} -\r\n */\r\nconst getDimensions = (data, metaData) =>\r\n{\r\n   const dimensions = {};\r\n   Obj.get(data, 'dimensions').each((dims) =>\r\n   {\r\n      for (const prop of s_DIMENSION_ATTR)\r\n      {\r\n         Obj.get(metaData, prop).orThunk(() => Obj.get(dims, prop)).each((value) => dimensions[prop] = value);\r\n      }\r\n   });\r\n   return dimensions;\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor} editor -\r\n *\r\n * @returns {MediaData} -\r\n */\r\nconst getEditorData = (editor) =>\r\n{\r\n   const element = editor.selection.getNode();\r\n   const snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\r\n   return {\r\n      embed: snippet,\r\n      ...htmlToData(snippet)\r\n   };\r\n};\r\n\r\n/**\r\n * @param {MediaDialogData}         data -\r\n *\r\n * @param {Record<string, string>}  metaData -\r\n *\r\n * @param {keyof MediaDialogData}   [sourceInput] -\r\n *\r\n * @returns {Function} {function(prop: keyof MediaDialogData): Record<string, string>}\r\n */\r\nconst getValue = (data, metaData, sourceInput) => (prop) =>\r\n{\r\n   // Cases:\r\n   // 1. Get the nested value prop (component is the executed urlinput)\r\n   // 2. Get from metadata (a urlinput was executed but urlinput != this component)\r\n   // 3. Not a urlinput so just get string\r\n   // If prop === sourceInput do 1, 2 then 3, else do 2 then 1 or 3\r\n   // ASSUMPTION: we only want to get values for props that already exist in data\r\n\r\n   /**\r\n    * @returns {Optional<string | Record<string, string> | DialogSubData>} -\r\n    */\r\n   const getFromData = () => Obj.get(data, prop);\r\n\r\n   /**\r\n    * @returns {Optional<string>} -\r\n    */\r\n   const getFromMetaData = () => Obj.get(metaData, prop);\r\n\r\n   /**\r\n    * Note v: string\r\n    *\r\n    * @param {Record<string, string>} c -\r\n    *\r\n    * @returns {Optional<string>} -\r\n    */\r\n   const getNonEmptyValue = (c) => Obj.get(c, 'value').bind((v) => v.length > 0 ? Optional.some(v) : Optional.none());\r\n\r\n   /**\r\n    * @returns {Optional<string>} -\r\n    */\r\n   const getFromValueFirst = () => getFromData().bind((child) => typeof child === 'object' ?\r\n    getNonEmptyValue(child).orThunk(getFromMetaData) : // as Record<string, string>\r\n     getFromMetaData().orThunk(() => Optional.from(child))); // as string\r\n\r\n   /**\r\n    * @returns {Optional<string>} -\r\n    */\r\n   const getFromMetaFirst = () => getFromMetaData().orThunk(() =>\r\n    getFromData().bind((child) => typeof child === 'object' ?\r\n     getNonEmptyValue(child) :   // as Record<string, string>\r\n      Optional.from(child)));    // as string\r\n\r\n   return { [prop]: (prop === sourceInput ? getFromValueFirst() : getFromMetaFirst()).getOr('') };\r\n};\r\n\r\n/**\r\n * @param {MediaData} prevData -\r\n *\r\n * @param {import('tinymce').Dialog.DialogInstanceApi<MediaDialogData>} api -\r\n *\r\n * @param {import('tinymce').Editor} editor -\r\n *\r\n * @returns {Promise<void>} -\r\n */\r\nconst handleSource = async (prevData, api, editor) =>\r\n{\r\n   const serviceData = Dialog.unwrap(api.getData(), 'source');\r\n\r\n   // If a new URL is entered, then clear the embed html and fetch the new data\r\n   if (prevData.source !== serviceData.source)\r\n   {\r\n      addEmbedHtml({ url: serviceData.source, html: '', poster: '' }, api, editor);\r\n\r\n      const response = await Service.getEmbedHtml(editor, serviceData);\r\n      if (response)\r\n      {\r\n         addEmbedHtml(response, api, editor);\r\n      }\r\n   }\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Dialog.DialogInstanceApi<MediaDialogData>} api -\r\n *\r\n * @param {import('tinymce').Editor} editor -\r\n */\r\nconst handleEmbed = (api, editor) =>\r\n{\r\n   const data = Dialog.unwrap(api.getData());\r\n   const dataFromEmbed = snippetToData(editor, data.embed);\r\n   api.setData(wrap(dataFromEmbed));\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Dialog.DialogInstanceApi<MediaDialogData>} api -\r\n *\r\n * @param {keyof MediaDialogData} sourceInput -\r\n */\r\nconst handleUpdate = (api, sourceInput) =>\r\n{\r\n   const data = Dialog.unwrap(api.getData(), sourceInput);\r\n   const embed = data.embed ? updateHtml(data.embed, data, false) : '';\r\n   api.setData(wrap({ ...data, embed }));\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor} editor -\r\n *\r\n * @param {string} html -\r\n *\r\n * @param {MediaData} data -\r\n */\r\nconst handleInsert = (editor, html, data) =>\r\n{\r\n   const beforeObjects = editor.dom.select('*[data-mce-object]');\r\n\r\n   Nodes.setPoster(data.poster);\r\n\r\n   editor.insertContent(html);\r\n\r\n   Nodes.setPoster(void 0);\r\n\r\n   const element = selectPlaceholder(editor, beforeObjects);\r\n\r\n   element.dataset.oembedPoster = data.poster;\r\n\r\n   editor.nodeChanged();\r\n};\r\n\r\n/**\r\n * @param {Element} element -\r\n *\r\n * @returns {string} -\r\n */\r\nconst isMediaElement = (element) => element.getAttribute('data-mce-object');\r\n\r\n/**\r\n *\r\n * @param {import('tinymce').Editor} editor -\r\n *\r\n * @param {HTMLElement[]} beforeObjects -\r\n *\r\n * @returns {HTMLElement} -\r\n */\r\nconst selectPlaceholder = (editor, beforeObjects) =>\r\n{\r\n   /**\r\n    * @type {HTMLElement[]}\r\n    */\r\n   const afterObjects = editor.dom.select('*[data-mce-object]');\r\n\r\n   // Find new image placeholder so we can select it\r\n   for (let i = 0; i < beforeObjects.length; i++)\r\n   {\r\n      for (let y = afterObjects.length - 1; y >= 0; y--)\r\n      {\r\n         if (beforeObjects[i] === afterObjects[y])\r\n         {\r\n            afterObjects.splice(y, 1);\r\n         }\r\n      }\r\n   }\r\n\r\n   editor.selection.select(afterObjects[0]);\r\n\r\n   return afterObjects[0];\r\n};\r\n\r\n/**\r\n * @param {import('tinymce').Editor}  editor -\r\n *\r\n * @param {string}  embedSnippet -\r\n *\r\n * @returns {MediaData} -\r\n */\r\nconst snippetToData = (editor, embedSnippet) => htmlToData(embedSnippet);\r\n\r\n/**\r\n * @param {MediaData} prevData -\r\n *\r\n * @param {MediaData} newData -\r\n *\r\n * @param {import('tinymce').Editor}    editor -\r\n *\r\n * @returns {Promise<void>} -\r\n */\r\nconst submitForm = async (prevData, newData, editor) =>\r\n{\r\n   newData.embed = updateHtml(newData.embed, newData);\r\n\r\n   // Only fetch the embed HTML content if the URL has changed from what it previously was\r\n   if (newData.embed && (prevData.source === newData.source || Service.isCached(newData.source)))\r\n   {\r\n      handleInsert(editor, newData.embed, newData);\r\n   }\r\n   else\r\n   {\r\n      const response = await Service.getEmbedHtml(editor, newData);\r\n      if (response)\r\n      {\r\n         handleInsert(editor, response.html, newData);\r\n      }\r\n   }\r\n};\r\n\r\n/**\r\n * @param {MediaData} data -\r\n *\r\n * @returns {MediaDialogData} -\r\n */\r\nconst wrap = (data) =>\r\n{\r\n   /**\r\n    * @type {MediaDialogData}\r\n    */\r\n   const wrapped = {\r\n      ...data,\r\n      source: { value: Obj.get(data, 'source').getOr('') },\r\n      poster: { value: Obj.get(data, 'poster').getOr('') }\r\n   };\r\n\r\n   // Add additional size values that may or may not have been in the html\r\n   for (const prop of s_DIMENSION_ATTR)\r\n   {\r\n      Obj.get(data, prop).each((value) =>\r\n      {\r\n         const dimensions = wrapped.dimensions || {};\r\n         dimensions[prop] = value;\r\n         wrapped.dimensions = dimensions;\r\n      });\r\n   }\r\n\r\n   return wrapped;\r\n};\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport FilterContent from './core/FilterContent.js';\r\nimport ResolveName   from './core/ResolveName.js';\r\nimport Selection     from './core/Selection.js';\r\nimport Buttons       from './ui/Buttons.js';\r\nimport Dialog        from './ui/Dialog.js';\r\n\r\nexport class PluginOembed\r\n{\r\n   constructor(editor)\r\n   {\r\n      editor.addCommand('typhonjsOembed', () => Dialog.showDialog(editor));\r\n      Buttons.register(editor);\r\n      ResolveName.setup(editor);\r\n      FilterContent.setup(editor);\r\n      Selection.setup(editor);\r\n   }\r\n\r\n   getMetadata()\r\n   {\r\n      return {\r\n         name: 'TyphonJS oEmbed',\r\n         url: 'https://github.com/typhonjs-tinymce/oembed'\r\n      };\r\n   }\r\n}\r\n\r\nexport default () =>\r\n{\r\n   tinymce.PluginManager.add('typhonjs-oembed', PluginOembed);\r\n};\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\n\r\n/**\r\n *\r\n */\r\nexport default class ResolveName\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    */\r\n   static setup(editor)\r\n   {\r\n      editor.on('ResolveName', (e) =>\r\n      {\r\n         let name;\r\n\r\n         if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object')))\r\n         {\r\n            e.name = name;\r\n         }\r\n      });\r\n   }\r\n}\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport Nodes         from './Nodes.js';\r\nimport { sanitize }  from './sanitize.js';\r\n\r\n/**\r\n *\r\n */\r\nexport default class FilterContent\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    */\r\n   static setup(editor)\r\n   {\r\n      editor.on('preInit', () =>\r\n      {\r\n         // Converts iframe, video etc into placeholder images\r\n         editor.parser.addNodeFilter('iframe,video,audio,object,embed', Nodes.placeHolderConverter(editor));\r\n\r\n         // Replaces placeholder images with real elements for video, object, iframe etc\r\n         editor.serializer.addAttributeFilter('data-mce-object', (nodes, name) =>\r\n         {\r\n            let i = nodes.length;\r\n            let node;\r\n            let realElm;\r\n            let ai;\r\n            let attribs;\r\n            let innerHtml;\r\n            let innerNode;\r\n            let realElmName;\r\n            let className;\r\n\r\n            while (i--)\r\n            {\r\n               node = nodes[i];\r\n               if (!node.parent) { continue; }\r\n\r\n               realElmName = node.attr(name);\r\n               realElm = new tinymce.html.Node(realElmName, 1);\r\n\r\n               // Add width/height to everything but audio\r\n               // if (realElmName !== 'audio' && realElmName !== 'script') {\r\n               if (realElmName !== 'audio')\r\n               {\r\n                  className = node.attr('class');\r\n                  if (className && className.indexOf('mce-preview-object') !== -1)\r\n                  {\r\n                     realElm.attr({\r\n                        width: node.firstChild.attr('width'),\r\n                        height: node.firstChild.attr('height')\r\n                     });\r\n                  }\r\n                  else\r\n                  {\r\n                     realElm.attr({\r\n                        width: node.attr('width'),\r\n                        height: node.attr('height')\r\n                     });\r\n                  }\r\n               }\r\n\r\n               realElm.attr({\r\n                  style: node.attr('style')\r\n               });\r\n\r\n               // Unprefix all placeholder attributes\r\n               attribs = node.attributes;\r\n               ai = attribs.length;\r\n               while (ai--)\r\n               {\r\n                  const attrName = attribs[ai].name;\r\n\r\n                  if (attrName.indexOf('data-mce-p-') === 0)\r\n                  {\r\n                     realElm.attr(attrName.substr(11), attribs[ai].value);\r\n                  }\r\n               }\r\n\r\n               // Inject innerhtml\r\n               innerHtml = node.attr('data-mce-html');\r\n               if (innerHtml)\r\n               {\r\n                  innerNode = new tinymce.html.Node('#text', 3);\r\n                  innerNode.raw = true;\r\n                  innerNode.value = sanitize(editor, unescape(innerHtml));\r\n                  realElm.append(innerNode);\r\n               }\r\n\r\n               node.replace(realElm);\r\n            }\r\n         });\r\n      });\r\n   }\r\n}\r\n","/**\r\n * Please see `./LICENSE` for license details.\r\n */\r\nimport { updateHtml } from './updateHtml.js';\r\n\r\n/**\r\n *\r\n */\r\nexport default class Selection\r\n{\r\n   /**\r\n    * @param {import('tinymce').Editor}  editor -\r\n    */\r\n   static setup(editor)\r\n   {\r\n      editor.on('click keyup touchend', () =>\r\n      {\r\n         const selectedNode = editor.selection.getNode();\r\n\r\n         if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object'))\r\n         {\r\n            if (editor.dom.getAttrib(selectedNode, 'data-mce-selected'))\r\n            {\r\n               selectedNode.setAttribute('data-mce-selected', '2');\r\n            }\r\n         }\r\n      });\r\n\r\n      editor.on('ObjectSelected', (e) =>\r\n      {\r\n         const objectType = e.target.getAttribute('data-mce-object');\r\n\r\n         if (objectType === 'script')\r\n         {\r\n            e.preventDefault();\r\n         }\r\n      });\r\n\r\n      editor.on('ObjectResized', (e) =>\r\n      {\r\n         const target = e.target;\r\n         let html;\r\n\r\n         if (target.getAttribute('data-mce-object'))\r\n         {\r\n            html = target.getAttribute('data-mce-html');\r\n            if (html)\r\n            {\r\n               html = unescape(html);\r\n               target.setAttribute('data-mce-html', escape(updateHtml(html, {\r\n                  width: String(e.width),\r\n                  height: String(e.height)\r\n               })));\r\n            }\r\n         }\r\n      });\r\n   }\r\n}\r\n\r\n"],"names":["Settings","static","editor","getParam","sanitize","html","shouldFilterHtml","writer","tinymce","Writer","blocked","SaxParser","validate","allow_conditional_comments","comment","text","cdata","raw","start","name","attrs","empty","i","length","attrName","indexOf","map","splice","value","dom","serializeStyle","parseStyle","end","Schema","parse","getContent","s_OEMBED_POSTER","Nodes","nodes","node","parent","attr","isLiveEmbedNode","hasLiveEmbeds","isWithinEmbedWrapper","replace","createPreviewNode","createPlaceholderNode","poster","previewWrapper","Node","contentEditable","style","class","retainAttributesAndInnerHtml","styles","previewNode","setDimensions","src","allowfullscreen","frameborder","sanitizedHtml","nodeName","newNode","DomParser","forced_root_block","schema","context","firstChild","append","appendNodeContent","shimNode","placeHolder","shortEnded","getDimension","dimension","defaultValue","Object","hasOwnProperty","call","isPageEmbedWrapper","nodeClass","test","sourceNode","targetNode","attribs","attributes","ai","attrValue","convertURL","innerHtml","escape","useDefaults","defaultWidth","fallbackHeight","defaultHeight","width","height","setAttributes","updatedAttrs","props","keys","k","len","push","sources","updateHtml","data","updateAll","hasImage","sourceCount","undefined","source","type","index","imgAttrs","stateSelectorAdapter","selector","buttonApi","selection","selectorChangedWithUnbind","join","setActive","unbind","Optional","constructor","tag","this","singletonNone","fold","onNone","onSome","isSome","isNone","mapper","some","none","bind","binder","exists","predicate","forall","filter","getOr","replacement","or","getOrThunk","thunk","orThunk","getOrDie","message","Error","a","getOrNull","getOrUndefined","each","worker","toArray","toString","get","obj","key","has","from","htmlToData","movie","assign","s_CACHE","Map","s_SERVICES","regex","url","maxwidth","maxheight","Service","response","embedHandler","getUrlResolver","handlerResponse","err","msg","notificationManager","open","oembedName","oembedUrl","getMediaWidth","getMediaHeight","service","exec","remoteResponse","window","fetch","status","json","error","thumbnail_url","set","Dialog","editorData","getEditorData","currentData","initialData","wrap","disableFilePoster","getDisableFilePoster","disableFileSource","getDisableFileSource","items","filetype","label","hasDimensions","constrain","disabled","body","windowManager","title","size","buttons","primary","onSubmit","async","api","serviceData","unwrap","getData","submitForm","close","onChange","detail","handleSource","handleEmbed","handleUpdate","console","log","sourceInput","metaData","extractMeta","getValue","getDimensions","s_DIMENSION_ATTR","addEmbedHtml","trim","nuData","snippetToData","embed","setData","Obj.get","mainData","dimensions","dims","prop","element","getNode","snippet","isMediaElement","serializer","serialize","getFromData","getFromMetaData","getNonEmptyValue","c","v","child","prevData","getEmbedHtml","dataFromEmbed","handleInsert","beforeObjects","select","setPoster","insertContent","selectPlaceholder","dataset","oembedPoster","nodeChanged","getAttribute","afterObjects","y","embedSnippet","newData","isCached","wrapped","PluginManager","add","addCommand","showDialog","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addMenuItem","register","on","e","target","nodeType","setup","parser","addNodeFilter","placeHolderConverter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","unescape","selectedNode","hasClass","getAttrib","setAttribute","preventDefault","String","getMetadata"],"mappings":"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"}