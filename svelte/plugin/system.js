import{get as e,writable as t}from"/modules/typhonjs/svelte/store.js";import{noop as s,run_all as r,is_function as n}from"/modules/typhonjs/svelte/internal.js";import{TJSGameSettings as i}from"/modules/typhonjs/svelte/store.js";function ownKeys(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,r)}return s}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(s),!0).forEach((function(t){_defineProperty(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}function _defineProperty(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}function _classPrivateFieldGet$1(e,t){var s=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,s)}function _classPrivateFieldInitSpec$1(e,t,s){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function _classPrivateFieldGet(e,t){var s=function(e,t,s){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,s)}function _classPrivateFieldInitSpec(e,t,s){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,s)}function generator(i){function readable(e,t,s){return{subscribe:writable(e,t,s).subscribe}}function writable(r,n,o=s){i&&(i.getItem(r)&&(n=JSON.parse(i.getItem(r))),i.setItem(r,JSON.stringify(n)));const a=t(n,o?function(e){return o((function(t){return i&&i.setItem(r,JSON.stringify(t)),e(t)}))}:void 0);function set(e){i&&i.setItem(r,JSON.stringify(e)),a.set(e)}return{set,update:function(t){set(t(e(a)))},subscribe:function(e,t=s){return a.subscribe(e,t)}}}return{readable,writable,derived:function(e,t,o,a){const l=!Array.isArray(t),c=l?[t]:t;return i&&i.getItem(e)&&(a=JSON.parse(i.getItem(e))),readable(e,a,(e=>{let t=!1;const i=[];let a=0,g=s;const sync=()=>{if(a)return;g();const t=l?i[0]:i;if(o.length<2)e(o(t));else{const r=o(t,e);g=n(r)?r:s}},u=c.map(((e,s)=>e.subscribe((e=>{i[s]=e,a&=~(1<<s),t&&sync()}),(()=>{a|=1<<s}))));return t=!0,sync(),function(){r(u),g()}}))},get:e}}var o=generator("undefined"!=typeof window?window.localStorage:void 0).writable,a=new WeakMap;class LocalStorage$1{constructor(){_classPrivateFieldInitSpec(this,a,{writable:!0,value:new Map})}getItem(e,t){let s=t;const r=localStorage.getItem(e);return void 0!==r&&(s=JSON.parse(r)),s}getStore(e,t){return s_GET_STORE$1(_classPrivateFieldGet(this,a),e,t)}setItem(e,t){s_GET_STORE$1(_classPrivateFieldGet(this,a),e).set(t)}swapItemBoolean(e,t){const s=s_GET_STORE$1(_classPrivateFieldGet(this,a),e,t),r=s.get(),n="boolean"==typeof r&&!r;return s.set(n),n}}function s_GET_STORE$1(t,s,r){let n=t.get(s);return void 0===n&&(n=function(t,s){try{localStorage.getItem(t)&&(s=JSON.parse(localStorage.getItem(t)))}catch(e){}const r=o(t,s);return r.get=()=>e(r),r}(s,r),t.set(s,n)),n}var l=generator("undefined"!=typeof window?window.sessionStorage:void 0).writable,c=new WeakMap;class SessionStorage$1{constructor(){_classPrivateFieldInitSpec(this,c,{writable:!0,value:new Map})}getItem(e,t){let s=t;const r=sessionStorage.getItem(e);return void 0!==r&&(s=JSON.parse(r)),s}getStore(e,t){return s_GET_STORE(_classPrivateFieldGet(this,c),e,t)}setItem(e,t){s_GET_STORE(_classPrivateFieldGet(this,c),e).set(t)}swapItemBoolean(e,t){const s=s_GET_STORE(_classPrivateFieldGet(this,c),e,t),r=s.get(),n="boolean"==typeof r&&!r;return s.set(n),n}}function s_GET_STORE(t,s,r){let n=t.get(s);return void 0===n&&(n=function(t,s){try{sessionStorage.getItem(t)&&(s=JSON.parse(sessionStorage.getItem(t)))}catch(e){}const r=l(t,s);return r.get=()=>e(r),r}(s,r),t.set(s,n)),n}var g=new WeakMap;class LocalStorage{constructor(){_classPrivateFieldInitSpec$1(this,g,{writable:!0,value:new LocalStorage$1})}onPluginLoad(e){var t;const s="string"==typeof(null==e||null===(t=e.pluginOptions)||void 0===t?void 0:t.eventPrepend)?`${e.pluginOptions.eventPrepend}:`:"";e.eventbus.on(`${s}storage:local:item:get`,_classPrivateFieldGet$1(this,g).getItem,_classPrivateFieldGet$1(this,g),{guard:!0}),e.eventbus.on(`${s}storage:local:item:boolean:swap`,_classPrivateFieldGet$1(this,g).swapItemBoolean,_classPrivateFieldGet$1(this,g),{guard:!0}),e.eventbus.on(`${s}storage:local:item:set`,_classPrivateFieldGet$1(this,g).setItem,_classPrivateFieldGet$1(this,g),{guard:!0}),e.eventbus.on(`${s}storage:local:store:get`,_classPrivateFieldGet$1(this,g).getStore,_classPrivateFieldGet$1(this,g),{guard:!0})}}var u=new WeakMap;class SessionStorage{constructor(){_classPrivateFieldInitSpec$1(this,u,{writable:!0,value:new SessionStorage$1})}onPluginLoad(e){var t;const s="string"==typeof(null==e||null===(t=e.pluginOptions)||void 0===t?void 0:t.eventPrepend)?`${e.pluginOptions.eventPrepend}:`:"";e.eventbus.on(`${s}storage:session:item:get`,_classPrivateFieldGet$1(this,u).getItem,_classPrivateFieldGet$1(this,u),{guard:!0}),e.eventbus.on(`${s}storage:session:item:boolean:swap`,_classPrivateFieldGet$1(this,u).swapItemBoolean,_classPrivateFieldGet$1(this,u),{guard:!0}),e.eventbus.on(`${s}storage:session:item:set`,_classPrivateFieldGet$1(this,u).setItem,_classPrivateFieldGet$1(this,u),{guard:!0}),e.eventbus.on(`${s}storage:session:store:get`,_classPrivateFieldGet$1(this,u).getStore,_classPrivateFieldGet$1(this,u),{guard:!0})}}var p=new WeakMap;class TJSGameSettings{constructor(){_classPrivateFieldInitSpec$1(this,p,{writable:!0,value:new i})}register(e,t,s){if("object"!=typeof s)throw new TypeError("TJSGameSettings - register: options is not an object.");const r="function"==typeof(null==s?void 0:s.onChange)?[s.onChange]:[];r.push((e=>{this._eventbus&&(this._eventbus.trigger("tjs:system:game:settings:change:any",{setting:t,value:e}),this._eventbus.trigger(`tjs:system:game:settings:change:${t}`,e))})),_classPrivateFieldGet$1(this,p).register(e,t,_objectSpread2(_objectSpread2({},s),{},{onChange:r}))}registerAll(e){if(null==(t=e)||"object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("TJSGameSettings - registerAll: settings is not iterable.");var t;for(const t of e){if("object"!=typeof t)throw new TypeError("TJSGameSettings - registerAll: entry in settings is not an object.");if("string"!=typeof t.moduleId)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'moduleId' attribute.");if("string"!=typeof t.key)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'key' attribute.");if("object"!=typeof t.options)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'options' attribute.");this.register(t.moduleId,t.key,t.options)}}onPluginLoad(e){this._eventbus=e.eventbus;const t={guard:!0};e.eventbus.on("tjs:system:game:settings:store:get",_classPrivateFieldGet$1(this,p).getStore,_classPrivateFieldGet$1(this,p),t),e.eventbus.on("tjs:system:game:settings:register",this.register,this,t),e.eventbus.on("tjs:system:game:settings:register:all",this.registerAll,this,t)}}export{LocalStorage,SessionStorage,TJSGameSettings};
//# sourceMappingURL=system.js.map
