import{get as e,writable as t}from"/modules/typhonjs/svelte/store.js";import{noop as n,run_all as r,is_function as s}from"/modules/typhonjs/svelte/internal.js";import{TJSGameSettings as o}from"/modules/typhonjs/svelte/store.js";function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){g(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){var n=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,n)}function l(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function c(e,t){var n=function(e,t,n){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,n)}function p(e,t,n){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,n)}function f(o){function i(e,t,n){return{subscribe:a(e,t,n).subscribe}}function a(r,s,i=n){o&&(o.getItem(r)&&(s=JSON.parse(o.getItem(r))),o.setItem(r,JSON.stringify(s)));const a=t(s,i?function(e){return i((function(t){return o&&o.setItem(r,JSON.stringify(t)),e(t)}))}:void 0);function g(e){o&&o.setItem(r,JSON.stringify(e)),a.set(e)}return{set:g,update:function(t){g(t(e(a)))},subscribe:function(e,t=n){return a.subscribe(e,t)}}}return{readable:i,writable:a,derived:function(e,t,a,g){const u=!Array.isArray(t),l=u?[t]:t;return o&&o.getItem(e)&&(g=JSON.parse(o.getItem(e))),i(e,g,(e=>{let t=!1;const o=[];let i=0,g=n;const c=()=>{if(i)return;g();const t=u?o[0]:o;if(a.length<2)e(a(t));else{const r=a(t,e);g=s(r)?r:n}},p=l.map(((e,n)=>e.subscribe((e=>{o[n]=e,i&=~(1<<n),t&&c()}),(()=>{i|=1<<n}))));return t=!0,c(),function(){r(p),g()}}))},get:e}}var m=f("undefined"!=typeof window?window.localStorage:void 0).writable,b=new WeakMap;class h{constructor(){p(this,b,{writable:!0,value:new Map})}getItem(e,t){let n=t;const r=localStorage.getItem(e);return void 0!==r&&(n=JSON.parse(r)),n}getStore(e,t){return v(c(this,b),e,t)}setItem(e,t){v(c(this,b),e).set(t)}swapItemBoolean(e,t){const n=v(c(this,b),e,t),r=n.get(),s="boolean"==typeof r&&!r;return n.set(s),s}}function v(t,n,r){let s=t.get(n);return void 0===s&&(s=function(t,n){try{localStorage.getItem(t)&&(n=JSON.parse(localStorage.getItem(t)))}catch(e){}const r=m(t,n);return r.get=()=>e(r),r}(n,r),t.set(n,s)),s}var w=f("undefined"!=typeof window?window.sessionStorage:void 0).writable,y=new WeakMap;class d{constructor(){p(this,y,{writable:!0,value:new Map})}getItem(e,t){let n=t;const r=sessionStorage.getItem(e);return void 0!==r&&(n=JSON.parse(r)),n}getStore(e,t){return S(c(this,y),e,t)}setItem(e,t){S(c(this,y),e).set(t)}swapItemBoolean(e,t){const n=S(c(this,y),e,t),r=n.get(),s="boolean"==typeof r&&!r;return n.set(s),s}}function S(t,n,r){let s=t.get(n);return void 0===s&&(s=function(t,n){try{sessionStorage.getItem(t)&&(n=JSON.parse(sessionStorage.getItem(t)))}catch(e){}const r=w(t,n);return r.get=()=>e(r),r}(n,r),t.set(n,s)),s}var j=new WeakMap;class O{constructor(){l(this,j,{writable:!0,value:new h})}onPluginLoad(e){var t;const n="string"==typeof(null==e||null===(t=e.pluginOptions)||void 0===t?void 0:t.eventPrepend)?`${e.pluginOptions.eventPrepend}:`:"";e.eventbus.on(`${n}storage:local:item:get`,u(this,j).getItem,u(this,j),{guard:!0}),e.eventbus.on(`${n}storage:local:item:boolean:swap`,u(this,j).swapItemBoolean,u(this,j),{guard:!0}),e.eventbus.on(`${n}storage:local:item:set`,u(this,j).setItem,u(this,j),{guard:!0}),e.eventbus.on(`${n}storage:local:store:get`,u(this,j).getStore,u(this,j),{guard:!0})}}var I=new WeakMap;class T{constructor(){l(this,I,{writable:!0,value:new d})}onPluginLoad(e){var t;const n="string"==typeof(null==e||null===(t=e.pluginOptions)||void 0===t?void 0:t.eventPrepend)?`${e.pluginOptions.eventPrepend}:`:"";e.eventbus.on(`${n}storage:session:item:get`,u(this,I).getItem,u(this,I),{guard:!0}),e.eventbus.on(`${n}storage:session:item:boolean:swap`,u(this,I).swapItemBoolean,u(this,I),{guard:!0}),e.eventbus.on(`${n}storage:session:item:set`,u(this,I).setItem,u(this,I),{guard:!0}),e.eventbus.on(`${n}storage:session:store:get`,u(this,I).getStore,u(this,I),{guard:!0})}}var J=new WeakMap;class P{constructor(){l(this,J,{writable:!0,value:new o})}register(e,t,n){if("object"!=typeof n)throw new TypeError("TJSGameSettings - register: options is not an object.");const r="function"==typeof(null==n?void 0:n.onChange)?[n.onChange]:[];r.push((e=>{this._eventbus&&(this._eventbus.trigger("tjs:system:game:settings:change:any",{setting:t,value:e}),this._eventbus.trigger(`tjs:system:game:settings:change:${t}`,e))})),u(this,J).register(e,t,a(a({},n),{},{onChange:r}))}registerAll(e){if(null==(t=e)||"object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("TJSGameSettings - registerAll: settings is not iterable.");var t;for(const t of e){if("object"!=typeof t)throw new TypeError("TJSGameSettings - registerAll: entry in settings is not an object.");if("string"!=typeof t.moduleId)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'moduleId' attribute.");if("string"!=typeof t.key)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'key' attribute.");if("object"!=typeof t.options)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'options' attribute.");this.register(t.moduleId,t.key,t.options)}}onPluginLoad(e){this._eventbus=e.eventbus;const t={guard:!0};e.eventbus.on("tjs:system:game:settings:store:get",u(this,J).getStore,u(this,J),t),e.eventbus.on("tjs:system:game:settings:register",this.register,this,t),e.eventbus.on("tjs:system:game:settings:register:all",this.registerAll,this,t)}}export{O as LocalStorage,T as SessionStorage,P as TJSGameSettings};
//# sourceMappingURL=system.js.map
