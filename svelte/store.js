import{noop as e,run_all as t,is_function as r}from"/modules/typhonjs/svelte/internal.js";function noop(){}function run(e){return e()}function subscribe(e,...t){if(null==e)return noop;const r=e.subscribe(...t);return r.unsubscribe?()=>r.unsubscribe():r}function get_store_value(e){let t;return subscribe(e,(e=>t=e))(),t}Promise.resolve();const n=[];function readable(e,t){return{subscribe:writable$2(e,t).subscribe}}function writable$2(e,t=noop){let r;const s=new Set;function set(t){if(i=t,((o=e)!=o?i==i:o!==i||o&&"object"==typeof o||"function"==typeof o)&&(e=t,r)){const t=!n.length;for(const t of s)t[1](),n.push(t,e);if(t){for(let e=0;e<n.length;e+=2)n[e][0](n[e+1]);n.length=0}}var o,i}return{set,update:function(t){set(t(e))},subscribe:function(n,o=noop){const i=[n,o];return s.add(i),1===s.size&&(r=t(set)||noop),n(e),()=>{s.delete(i),0===s.size&&(r(),r=null)}}}}function derived(e,t,r){const n=!Array.isArray(e),s=n?[e]:e,o=t.length<2;return readable(r,(e=>{let r=!1;const i=[];let a=0,c=noop;const sync=()=>{if(a)return;c();const r=t(n?i[0]:i,e);o?e(r):c="function"==typeof r?r:noop},l=s.map(((e,t)=>subscribe(e,(e=>{i[t]=e,a&=~(1<<t),r&&sync()}),(()=>{a|=1<<t}))));return r=!0,sync(),function(){l.forEach(run),c()}}))}function ownKeys(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(r),!0).forEach((function(t){_defineProperty(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function _classPrivateFieldGet$1(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,r)}function _classPrivateFieldGet(e,t){var r=function(e,t,r){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}(e,t);return function(e,t){return t.get?t.get.call(e):t.value}(e,r)}function _classPrivateFieldInitSpec(e,t,r){!function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function generator(n){function readable(e,t,r){return{subscribe:writable(e,t,r).subscribe}}function writable(t,r,s=e){n&&(n.getItem(t)&&(r=JSON.parse(n.getItem(t))),n.setItem(t,JSON.stringify(r)));const o=writable$2(r,s?function(e){return s((function(r){return n&&n.setItem(t,JSON.stringify(r)),e(r)}))}:void 0);function set(e){n&&n.setItem(t,JSON.stringify(e)),o.set(e)}return{set,update:function(e){set(e(get_store_value(o)))},subscribe:function(t,r=e){return o.subscribe(t,r)}}}return{readable,writable,derived:function(s,o,i,a){const c=!Array.isArray(o),l=c?[o]:o;return n&&n.getItem(s)&&(a=JSON.parse(n.getItem(s))),readable(s,a,(n=>{let s=!1;const o=[];let a=0,u=e;const sync=()=>{if(a)return;u();const t=c?o[0]:o;if(i.length<2)n(i(t));else{const s=i(t,n);u=r(s)?s:e}},g=l.map(((e,t)=>e.subscribe((e=>{o[t]=e,a&=~(1<<t),s&&sync()}),(()=>{a|=1<<t}))));return s=!0,sync(),function(){t(g),u()}}))},get:get_store_value}}var s=generator("undefined"!=typeof window?window.localStorage:void 0).writable,o=new WeakMap;class LocalStorage{constructor(){_classPrivateFieldInitSpec(this,o,{writable:!0,value:new Map})}getItem(e,t){let r=t;const n=localStorage.getItem(e);return void 0!==n&&(r=JSON.parse(n)),r}getStore(e,t){return s_GET_STORE$1(_classPrivateFieldGet(this,o),e,t)}setItem(e,t){s_GET_STORE$1(_classPrivateFieldGet(this,o),e).set(t)}swapItemBoolean(e,t){const r=s_GET_STORE$1(_classPrivateFieldGet(this,o),e,t),n=r.get(),s="boolean"==typeof n&&!n;return r.set(s),s}}function s_GET_STORE$1(e,t,r){let n=e.get(t);return void 0===n&&(n=function(e,t){try{localStorage.getItem(e)&&(t=JSON.parse(localStorage.getItem(e)))}catch(e){}const r=s(e,t);return r.get=()=>get_store_value(r),r}(t,r),e.set(t,n)),n}var i=generator("undefined"!=typeof window?window.sessionStorage:void 0).writable,a=new WeakMap;class SessionStorage{constructor(){_classPrivateFieldInitSpec(this,a,{writable:!0,value:new Map})}getItem(e,t){let r=t;const n=sessionStorage.getItem(e);return void 0!==n&&(r=JSON.parse(n)),r}getStore(e,t){return s_GET_STORE$2(_classPrivateFieldGet(this,a),e,t)}setItem(e,t){s_GET_STORE$2(_classPrivateFieldGet(this,a),e).set(t)}swapItemBoolean(e,t){const r=s_GET_STORE$2(_classPrivateFieldGet(this,a),e,t),n=r.get(),s="boolean"==typeof n&&!n;return r.set(s),s}}function s_GET_STORE$2(e,t,r){let n=e.get(t);return void 0===n&&(n=function(e,t){try{sessionStorage.getItem(e)&&(t=JSON.parse(sessionStorage.getItem(e)))}catch(e){}const r=i(e,t);return r.get=()=>get_store_value(r),r}(t,r),e.set(t,n)),n}function isIterable(e){return null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.iterator]}var c=new WeakMap;class TJSGameSettings{constructor(){var e,t;e=c,t={writable:!0,value:new Map},function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}(this,e),e.set(this,t)}getStore(e){if(_classPrivateFieldGet$1(this,c).has(e))return s_GET_STORE(_classPrivateFieldGet$1(this,c),e);console.warn(`TJSGameSettings - getStore: '${e}' is not a registered setting.`)}register(e,t,r={}){if("object"!=typeof r)throw new TypeError("TJSGameSettings - register: options is not an object.");const n=[];if(isIterable(null==r?void 0:r.onChange))for(const e of r.onChange)"function"==typeof e&&n.push(e);else"function"==typeof r.onChange&&n.push(r.onChange);n.push((e=>{const r=s_GET_STORE(_classPrivateFieldGet$1(this,c),t);r&&r.set(e)})),game.settings.register(e,t,_objectSpread2(_objectSpread2({},r),{},{onChange:e=>{for(const t of n)t(e)}})),s_GET_STORE(_classPrivateFieldGet$1(this,c),t).set(game.settings.get(e,t))}registerAll(e){if(!isIterable(e))throw new TypeError("TJSGameSettings - registerAll: settings is not iterable.");for(const t of e){if("object"!=typeof t)throw new TypeError("TJSGameSettings - registerAll: entry in settings is not an object.");if("string"!=typeof t.moduleId)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'moduleId' attribute.");if("string"!=typeof t.key)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'key' attribute.");if("object"!=typeof t.options)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'options' attribute.");this.register(t.moduleId,t.key,t.options)}}}function s_GET_STORE(e,t){let r=e.get(t);return void 0===r&&(r=function(){const e=writable$2(void 0);return e.get=()=>get_store_value(e),e}(),e.set(t,r)),r}export{LocalStorage,SessionStorage,TJSGameSettings,derived,get_store_value as get,readable,writable$2 as writable};
//# sourceMappingURL=store.js.map
