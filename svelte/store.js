import{noop as t,run_all as e,is_function as n}from"/modules/typhonjs/svelte/internal.js";function r(){}function o(t){return t()}function i(t,...e){if(null==t)return r;const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function s(t){let e;return i(t,(t=>e=t))(),e}Promise.resolve();const c=[];function u(t,e){return{subscribe:a(t,e).subscribe}}function a(t,e=r){let n;const o=new Set;function i(e){if(i=e,((r=t)!=r?i==i:r!==i||r&&"object"==typeof r||"function"==typeof r)&&(t=e,n)){const e=!c.length;for(const e of o)e[1](),c.push(e,t);if(e){for(let t=0;t<c.length;t+=2)c[t][0](c[t+1]);c.length=0}}var r,i}return{set:i,update:function(e){i(e(t))},subscribe:function(s,c=r){const u=[s,c];return o.add(u),1===o.size&&(n=e(i)||r),s(t),()=>{o.delete(u),0===o.size&&(n(),n=null)}}}}function f(t,e,n){const s=!Array.isArray(t),c=s?[t]:t,a=e.length<2;return u(n,(t=>{let n=!1;const u=[];let f=0,l=r;const g=()=>{if(f)return;l();const n=e(s?u[0]:u,t);a?t(n):l="function"==typeof n?n:r},p=c.map(((t,e)=>i(t,(t=>{u[e]=t,f&=~(1<<e),n&&g()}),(()=>{f|=1<<e}))));return n=!0,g(),function(){p.forEach(o),l()}}))}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function g(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){p(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function b(t,e){var n=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}(t,e);return function(t,e){return e.get?e.get.call(t):e.value}(t,n)}function y(t,e){var n=function(t,e,n){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}(t,e);return function(t,e){return e.get?e.get.call(t):e.value}(t,n)}function h(t,e,n){!function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(t,e),e.set(t,n)}function w(r){function o(t,e,n){return{subscribe:i(t,e,n).subscribe}}function i(e,n,o=t){r&&(r.getItem(e)&&(n=JSON.parse(r.getItem(e))),r.setItem(e,JSON.stringify(n)));const i=a(n,o?function(t){return o((function(n){return r&&r.setItem(e,JSON.stringify(n)),t(n)}))}:void 0);function c(t){r&&r.setItem(e,JSON.stringify(t)),i.set(t)}return{set:c,update:function(t){c(t(s(i)))},subscribe:function(e,n=t){return i.subscribe(e,n)}}}return{readable:o,writable:i,derived:function(i,s,c,u){const a=!Array.isArray(s),f=a?[s]:s;return r&&r.getItem(i)&&(u=JSON.parse(r.getItem(i))),o(i,u,(r=>{let o=!1;const i=[];let s=0,u=t;const l=()=>{if(s)return;u();const e=a?i[0]:i;if(c.length<2)r(c(e));else{const o=c(e,r);u=n(o)?o:t}},g=f.map(((t,e)=>t.subscribe((t=>{i[e]=t,s&=~(1<<e),o&&l()}),(()=>{s|=1<<e}))));return o=!0,l(),function(){e(g),u()}}))},get:s}}var m=w("undefined"!=typeof window?window.localStorage:void 0).writable,d=new WeakMap;class S{constructor(){h(this,d,{writable:!0,value:new Map})}getItem(t,e){let n=e;const r=localStorage.getItem(t);return void 0!==r&&(n=JSON.parse(r)),n}getStore(t,e){return v(y(this,d),t,e)}setItem(t,e){v(y(this,d),t).set(e)}swapItemBoolean(t,e){const n=v(y(this,d),t,e),r=n.get(),o="boolean"==typeof r&&!r;return n.set(o),o}}function v(t,e,n){let r=t.get(e);return void 0===r&&(r=function(t,e){try{localStorage.getItem(t)&&(e=JSON.parse(localStorage.getItem(t)))}catch(t){}const n=m(t,e);return n.get=()=>s(n),n}(e,n),t.set(e,r)),r}var O=w("undefined"!=typeof window?window.sessionStorage:void 0).writable,j=new WeakMap;class I{constructor(){h(this,j,{writable:!0,value:new Map})}getItem(t,e){let n=e;const r=sessionStorage.getItem(t);return void 0!==r&&(n=JSON.parse(r)),n}getStore(t,e){return T(y(this,j),t,e)}setItem(t,e){T(y(this,j),t).set(e)}swapItemBoolean(t,e){const n=T(y(this,j),t,e),r=n.get(),o="boolean"==typeof r&&!r;return n.set(o),o}}function T(t,e,n){let r=t.get(e);return void 0===r&&(r=function(t,e){try{sessionStorage.getItem(t)&&(e=JSON.parse(sessionStorage.getItem(t)))}catch(t){}const n=O(t,e);return n.get=()=>s(n),n}(e,n),t.set(e,r)),r}function J(t){return null!=t&&"object"==typeof t&&"function"==typeof t[Symbol.iterator]}var E=new WeakMap;class A{constructor(){var t,e;t=E,e={writable:!0,value:new Map},function(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}(this,t),t.set(this,e)}getStore(t){if(b(this,E).has(t))return P(b(this,E),t);console.warn(`TJSGameSettings - getStore: '${t}' is not a registered setting.`)}register(t,e,n={}){if("object"!=typeof n)throw new TypeError("TJSGameSettings - register: options is not an object.");const r=[];if(J(null==n?void 0:n.onChange))for(const t of n.onChange)"function"==typeof t&&r.push(t);else"function"==typeof n.onChange&&r.push(n.onChange);r.push((t=>{const n=P(b(this,E),e);n&&n.set(t)})),game.settings.register(t,e,g(g({},n),{},{onChange:t=>{for(const e of r)e(t)}})),P(b(this,E),e).set(game.settings.get(t,e))}registerAll(t){if(!J(t))throw new TypeError("TJSGameSettings - registerAll: settings is not iterable.");for(const e of t){if("object"!=typeof e)throw new TypeError("TJSGameSettings - registerAll: entry in settings is not an object.");if("string"!=typeof e.moduleId)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'moduleId' attribute.");if("string"!=typeof e.key)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'key' attribute.");if("object"!=typeof e.options)throw new TypeError("TJSGameSettings - registerAll: entry in settings missing 'options' attribute.");this.register(e.moduleId,e.key,e.options)}}}function P(t,e){let n=t.get(e);return void 0===n&&(n=function(){const t=a(void 0);return t.get=()=>s(t),t}(),t.set(e,n)),n}export{S as LocalStorage,I as SessionStorage,A as TJSGameSettings,f as derived,s as get,u as readable,a as writable};
//# sourceMappingURL=store.js.map
