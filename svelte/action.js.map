{"version":3,"file":"action.js","sources":["../node_modules/@typhonjs-fvtt/svelte/src/action/draggable.js"],"sourcesContent":["/**\r\n * Provides an action to enable pointer dragging of an HTMLElement and invoke `setPosition` on given Positionable\r\n * object provided. When the attached boolean store state changes the draggable action is enabled or disabled.\r\n *\r\n * @param {HTMLElement}       node - The node associated with the action.\r\n *\r\n * @param {object}            params - Required parameters.\r\n *\r\n * @param {Positionable}      params.positionable - A positionable object.\r\n *\r\n * @param {Readable<boolean>} params.booleanStore - A Svelte store that contains a boolean.\r\n *\r\n * @returns {{update: Function, destroy: Function}} The action lifecycle methods.\r\n */\r\nexport function draggable(node, { positionable, booleanStore })\r\n{\r\n   /**\r\n    * Duplicate the app / Positionable starting position to track differences.\r\n    *\r\n    * @type {object}\r\n    */\r\n   let position = null;\r\n\r\n   /**\r\n    * Stores the initial X / Y on drag down.\r\n    *\r\n    * @type {object}\r\n    */\r\n   let initialPosition = {};\r\n\r\n   /**\r\n    * Throttle mousemove event handling to 60fps\r\n    *\r\n    * @type {number}\r\n    */\r\n   let moveTime = 0;\r\n\r\n   /**\r\n    * Stores the active state and is used to cut off any active dragging when the store value changes.\r\n    *\r\n    * @type {Readable<boolean>}\r\n    */\r\n   let active = booleanStore;\r\n\r\n   /**\r\n    * Remember event handlers associated with this action so they may be later unregistered.\r\n    *\r\n    * @type {object}\r\n    */\r\n   const handlers = {\r\n      dragDown: ['pointerdown', (e) => onDragPointerDown(e), false],\r\n      dragMove: ['pointermove', (e) => onDragPointerMove(e), false],\r\n      dragUp: ['pointerup', (e) => onDragPointerUp(e), false]\r\n   };\r\n\r\n   /**\r\n    * Activates listeners.\r\n    */\r\n   function activateListeners()\r\n   {\r\n      active = true;\r\n\r\n      // Drag handlers\r\n      node.addEventListener(...handlers.dragDown);\r\n      node.classList.add('draggable');\r\n   }\r\n\r\n   /**\r\n    * Removes listeners.\r\n    */\r\n   function removeListeners()\r\n   {\r\n      active = false;\r\n\r\n      // Drag handlers\r\n      node.removeEventListener(...handlers.dragDown);\r\n      node.removeEventListener(...handlers.dragMove);\r\n      node.removeEventListener(...handlers.dragUp);\r\n      node.classList.remove('draggable');\r\n   }\r\n\r\n   if (active)\r\n   {\r\n      activateListeners();\r\n   }\r\n\r\n   /**\r\n    * Handle the initial pointer down which activates dragging behavior for the positionable.\r\n    *\r\n    * @param {PointerEvent} event - The pointer down event.\r\n    */\r\n   function onDragPointerDown(event)\r\n   {\r\n      event.preventDefault();\r\n\r\n      // Record initial position\r\n      position = foundry.utils.duplicate(positionable.position);\r\n      initialPosition = { x: event.clientX, y: event.clientY };\r\n\r\n      // Add temporary handlers\r\n      globalThis.addEventListener(...handlers.dragMove);\r\n      globalThis.addEventListener(...handlers.dragUp);\r\n   }\r\n\r\n   /**\r\n    * Move the positionable.\r\n    *\r\n    * @param {PointerEvent} event - The pointer move event.\r\n    */\r\n   function onDragPointerMove(event)\r\n   {\r\n      event.preventDefault();\r\n\r\n      if (!active) { return; }\r\n\r\n      // Limit dragging to 60 updates per second\r\n      const now = Date.now();\r\n\r\n      if ((now - moveTime) < (1000 / 60)) { return; }\r\n\r\n      moveTime = now;\r\n\r\n      // Update application position\r\n      positionable.setPosition({\r\n         left: position.left + (event.clientX - initialPosition.x),\r\n         top: position.top + (event.clientY - initialPosition.y)\r\n      });\r\n   }\r\n\r\n   /**\r\n    * Conclude the dragging behavior when the mouse is release, setting the final position and removing listeners\r\n    *\r\n    * @param {PointerEvent} event - The pointer up event.\r\n    */\r\n   function onDragPointerUp(event)\r\n   {\r\n      event.preventDefault();\r\n      globalThis.removeEventListener(...handlers.dragMove);\r\n      globalThis.removeEventListener(...handlers.dragUp);\r\n   }\r\n\r\n   return {\r\n      update: ({ booleanStore }) =>  // eslint-disable-line no-shadow\r\n      {\r\n         if (booleanStore) { activateListeners(); }\r\n         else { removeListeners(); }\r\n      },\r\n\r\n      destroy: () => removeListeners()\r\n   };\r\n}"],"names":[],"mappings":"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"}